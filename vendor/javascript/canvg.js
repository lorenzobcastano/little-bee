import"core-js/modules/es.promise.js";import t from"@babel/runtime/helpers/asyncToGenerator";import"core-js/modules/es.string.match.js";import"core-js/modules/es.string.replace.js";import"core-js/modules/es.string.starts-with.js";import"core-js/modules/es.array.iterator.js";import"core-js/modules/web.dom-collections.iterator.js";import e from"@babel/runtime/helpers/defineProperty";import"core-js/modules/es.array.reduce.js";import"core-js/modules/es.string.ends-with.js";import"core-js/modules/es.string.split.js";import r from"raf";import"core-js/modules/es.string.trim.js";import i from"rgbcolor";import"core-js/modules/es.array.index-of.js";import"core-js/modules/es.string.includes.js";import"core-js/modules/es.array.reverse.js";import{SVGPathData as a}from"svg-pathdata";import"core-js/modules/es.regexp.to-string.js";import{canvasRGBA as s}from"stackblur-canvas";
/**
 * Options preset for `OffscreenCanvas`.
 * @param config - Preset requirements.
 * @param config.DOMParser - XML/HTML parser from string into DOM Document.
 * @returns Preset object.
 */function offscreen(){var{DOMParser:e}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};var r={window:null,ignoreAnimation:true,ignoreMouse:true,DOMParser:e,createCanvas(t,e){return new OffscreenCanvas(t,e)},createImage(e){return t((function*(){var t=yield fetch(e);var r=yield t.blob();var i=yield createImageBitmap(r);return i}))()}};"undefined"===typeof DOMParser&&"undefined"!==typeof e||Reflect.deleteProperty(r,"DOMParser");return r}
/**
 * Options preset for `node-canvas`.
 * @param config - Preset requirements.
 * @param config.DOMParser - XML/HTML parser from string into DOM Document.
 * @param config.canvas - `node-canvas` exports.
 * @param config.fetch - WHATWG-compatible `fetch` function.
 * @returns Preset object.
 */function node(t){var{DOMParser:e,canvas:r,fetch:i}=t;return{window:null,ignoreAnimation:true,ignoreMouse:true,DOMParser:e,fetch:i,createCanvas:r.createCanvas,createImage:r.loadImage}}var n=Object.freeze({__proto__:null,offscreen:offscreen,node:node});
/**
 * HTML-safe compress white-spaces.
 * @param str - String to compress.
 * @returns String.
 */function compressSpaces(t){return t.replace(/(?!\u3000)\s+/gm," ")}
/**
 * HTML-safe left trim.
 * @param str - String to trim.
 * @returns String.
 */function trimLeft(t){return t.replace(/^[\n \t]+/,"")}
/**
 * HTML-safe right trim.
 * @param str - String to trim.
 * @returns String.
 */function trimRight(t){return t.replace(/[\n \t]+$/,"")}
/**
 * String to numbers array.
 * @param str - Numbers string.
 * @returns Numbers array.
 */function toNumbers(t){var e=(t||"").match(/-?(\d+(?:\.\d*(?:[eE][+-]?\d+)?)?|\.\d+)(?=\D|$)/gm)||[];return e.map(parseFloat)}var o=/^[A-Z-]+$/;
/**
 * Normalize attribute name.
 * @param name - Attribute name.
 * @returns Normalized attribute name.
 */function normalizeAttributeName(t){return o.test(t)?t.toLowerCase():t}
/**
 * Parse external URL.
 * @param url - CSS url string.
 * @returns Parsed URL.
 */function parseExternalUrl(t){var e=/url\(('([^']+)'|"([^"]+)"|([^'")]+))\)/.exec(t)||[];return e[2]||e[3]||e[4]}
/**
 * Transform floats to integers in rgb colors.
 * @param color - Color to normalize.
 * @returns Normalized color.
 */function normalizeColor(t){if(!t.startsWith("rgb"))return t;var e=3;var r=t.replace(/\d+(\.\d+)?/g,((t,r)=>e--&&r?String(Math.round(parseFloat(t))):t));return r}var h=/(\[[^\]]+\])/g;var l=/(#[^\s+>~.[:]+)/g;var u=/(\.[^\s+>~.[:]+)/g;var g=/(::[^\s+>~.[:]+|:first-line|:first-letter|:before|:after)/gi;var d=/(:[\w-]+\([^)]*\))/gi;var v=/(:[^\s+>~.[:]+)/g;var p=/([^\s+>~.[:]+)/g;function findSelectorMatch(t,e){var r=e.exec(t);return r?[t.replace(e," "),r.length]:[t,0]}
/**
 * Measure selector specificity.
 * @param selector - Selector to measure.
 * @returns Specificity.
 */function getSelectorSpecificity(t){var e=[0,0,0];var r=t.replace(/:not\(([^)]*)\)/g,"     $1 ").replace(/{[\s\S]*/gm," ");var i=0;[r,i]=findSelectorMatch(r,h);e[1]+=i;[r,i]=findSelectorMatch(r,l);e[0]+=i;[r,i]=findSelectorMatch(r,u);e[1]+=i;[r,i]=findSelectorMatch(r,g);e[2]+=i;[r,i]=findSelectorMatch(r,d);e[1]+=i;[r,i]=findSelectorMatch(r,v);e[1]+=i;r=r.replace(/[*\s+>~]/g," ").replace(/[#.]/g," ");[r,i]=findSelectorMatch(r,p);e[2]+=i;return e.join("")}var f=1e-8;
/**
 * Vector magnitude.
 * @param v
 * @returns Number result.
 */function vectorMagnitude(t){return Math.sqrt(Math.pow(t[0],2)+Math.pow(t[1],2))}
/**
 * Ratio between two vectors.
 * @param u
 * @param v
 * @returns Number result.
 */function vectorsRatio(t,e){return(t[0]*e[0]+t[1]*e[1])/(vectorMagnitude(t)*vectorMagnitude(e))}
/**
 * Angle between two vectors.
 * @param u
 * @param v
 * @returns Number result.
 */function vectorsAngle(t,e){return(t[0]*e[1]<t[1]*e[0]?-1:1)*Math.acos(vectorsRatio(t,e))}function CB1(t){return t*t*t}function CB2(t){return 3*t*t*(1-t)}function CB3(t){return 3*t*(1-t)*(1-t)}function CB4(t){return(1-t)*(1-t)*(1-t)}function QB1(t){return t*t}function QB2(t){return 2*t*(1-t)}function QB3(t){return(1-t)*(1-t)}class Property{constructor(t,e,r){this.document=t;this.name=e;this.value=r;this.isNormalizedColor=false}static empty(t){return new Property(t,"EMPTY","")}split(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:" ";var{document:e,name:r}=this;return compressSpaces(this.getString()).trim().split(t).map((t=>new Property(e,r,t)))}hasValue(t){var{value:e}=this;return null!==e&&""!==e&&(t||0!==e)&&"undefined"!==typeof e}isString(t){var{value:e}=this;var r="string"===typeof e;return r&&t?t.test(e):r}isUrlDefinition(){return this.isString(/^url\(/)}isPixels(){if(!this.hasValue())return false;var t=this.getString();switch(true){case t.endsWith("px"):case/^[0-9]+$/.test(t):return true;default:return false}}setValue(t){this.value=t;return this}getValue(t){return"undefined"===typeof t||this.hasValue()?this.value:t}getNumber(t){if(!this.hasValue())return"undefined"===typeof t?0:parseFloat(t);var{value:e}=this;var r=parseFloat(e);this.isString(/%$/)&&(r/=100);return r}getString(t){return"undefined"===typeof t||this.hasValue()?"undefined"===typeof this.value?"":String(this.value):String(t)}getColor(t){var e=this.getString(t);if(this.isNormalizedColor)return e;this.isNormalizedColor=true;e=normalizeColor(e);this.value=e;return e}getDpi(){return 96}getRem(){return this.document.rootEmSize}getEm(){return this.document.emSize}getUnits(){return this.getString().replace(/[0-9.-]/g,"")}getPixels(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!this.hasValue())return 0;var[r,i]="boolean"===typeof t?[void 0,t]:[t];var{viewPort:a}=this.document.screen;switch(true){case this.isString(/vmin$/):return this.getNumber()/100*Math.min(a.computeSize("x"),a.computeSize("y"));case this.isString(/vmax$/):return this.getNumber()/100*Math.max(a.computeSize("x"),a.computeSize("y"));case this.isString(/vw$/):return this.getNumber()/100*a.computeSize("x");case this.isString(/vh$/):return this.getNumber()/100*a.computeSize("y");case this.isString(/rem$/):return this.getNumber()*this.getRem();case this.isString(/em$/):return this.getNumber()*this.getEm();case this.isString(/ex$/):return this.getNumber()*this.getEm()/2;case this.isString(/px$/):return this.getNumber();case this.isString(/pt$/):return this.getNumber()*this.getDpi()*(1/72);case this.isString(/pc$/):return 15*this.getNumber();case this.isString(/cm$/):return this.getNumber()*this.getDpi()/2.54;case this.isString(/mm$/):return this.getNumber()*this.getDpi()/25.4;case this.isString(/in$/):return this.getNumber()*this.getDpi();case this.isString(/%$/)&&i:return this.getNumber()*this.getEm();case this.isString(/%$/):return this.getNumber()*a.computeSize(r);default:var s=this.getNumber();return e&&s<1?s*a.computeSize(r):s}}getMilliseconds(){return this.hasValue()?this.isString(/ms$/)?this.getNumber():1e3*this.getNumber():0}getRadians(){if(!this.hasValue())return 0;switch(true){case this.isString(/deg$/):return this.getNumber()*(Math.PI/180);case this.isString(/grad$/):return this.getNumber()*(Math.PI/200);case this.isString(/rad$/):return this.getNumber();default:return this.getNumber()*(Math.PI/180)}}getDefinition(){var t=this.getString();var e=/#([^)'"]+)/.exec(t);e&&(e=e[1]);e||(e=t);return this.document.definitions[e]}getFillStyleDefinition(t,e){var r=this.getDefinition();if(!r)return null;if("function"===typeof r.createGradient)return r.createGradient(this.document.ctx,t,e);if("function"===typeof r.createPattern){if(r.getHrefAttribute().hasValue()){var i=r.getAttribute("patternTransform");r=r.getHrefAttribute().getDefinition();i.hasValue()&&r.getAttribute("patternTransform",true).setValue(i.value)}return r.createPattern(this.document.ctx,t,e)}return null}getTextBaseline(){return this.hasValue()?Property.textBaselineMapping[this.getString()]:null}addOpacity(t){var e=this.getColor();var r=e.length;var a=0;for(var s=0;s<r;s++){","===e[s]&&a++;if(3===a)break}if(t.hasValue()&&this.isString()&&3!==a){var n=new i(e);if(n.ok){n.alpha=t.getNumber();e=n.toRGBA()}}return new Property(this.document,this.name,e)}}Property.textBaselineMapping={baseline:"alphabetic","before-edge":"top","text-before-edge":"top",middle:"middle",central:"middle","after-edge":"bottom","text-after-edge":"bottom",ideographic:"ideographic",alphabetic:"alphabetic",hanging:"hanging",mathematical:"alphabetic"};class ViewPort{constructor(){this.viewPorts=[]}clear(){this.viewPorts=[]}setCurrent(t,e){this.viewPorts.push({width:t,height:e})}removeCurrent(){this.viewPorts.pop()}getCurrent(){var{viewPorts:t}=this;return t[t.length-1]}get width(){return this.getCurrent().width}get height(){return this.getCurrent().height}computeSize(t){return"number"===typeof t?t:"x"===t?this.width:"y"===t?this.height:Math.sqrt(Math.pow(this.width,2)+Math.pow(this.height,2))/Math.sqrt(2)}}class Point{constructor(t,e){this.x=t;this.y=e}static parse(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;var[r=e,i=e]=toNumbers(t);return new Point(r,i)}static parseScale(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;var[r=e,i=r]=toNumbers(t);return new Point(r,i)}static parsePath(t){var e=toNumbers(t);var r=e.length;var i=[];for(var a=0;a<r;a+=2)i.push(new Point(e[a],e[a+1]));return i}angleTo(t){return Math.atan2(t.y-this.y,t.x-this.x)}applyTransform(t){var{x:e,y:r}=this;var i=e*t[0]+r*t[2]+t[4];var a=e*t[1]+r*t[3]+t[5];this.x=i;this.y=a}}class Mouse{constructor(t){this.screen=t;this.working=false;this.events=[];this.eventElements=[];this.onClick=this.onClick.bind(this);this.onMouseMove=this.onMouseMove.bind(this)}isWorking(){return this.working}start(){if(!this.working){var{screen:t,onClick:e,onMouseMove:r}=this;var i=t.ctx.canvas;i.onclick=e;i.onmousemove=r;this.working=true}}stop(){if(this.working){var t=this.screen.ctx.canvas;this.working=false;t.onclick=null;t.onmousemove=null}}hasEvents(){return this.working&&this.events.length>0}runEvents(){if(this.working){var{screen:t,events:e,eventElements:r}=this;var{style:i}=t.ctx.canvas;i&&(i.cursor="");e.forEach(((t,e)=>{var{run:i}=t;var a=r[e];while(a){i(a);a=a.parent}}));this.events=[];this.eventElements=[]}}checkPath(t,e){if(this.working&&e){var{events:r,eventElements:i}=this;r.forEach(((r,a)=>{var{x:s,y:n}=r;!i[a]&&e.isPointInPath&&e.isPointInPath(s,n)&&(i[a]=t)}))}}checkBoundingBox(t,e){if(this.working&&e){var{events:r,eventElements:i}=this;r.forEach(((r,a)=>{var{x:s,y:n}=r;!i[a]&&e.isPointInBox(s,n)&&(i[a]=t)}))}}mapXY(t,e){var{window:r,ctx:i}=this.screen;var a=new Point(t,e);var s=i.canvas;while(s){a.x-=s.offsetLeft;a.y-=s.offsetTop;s=s.offsetParent}r.scrollX&&(a.x+=r.scrollX);r.scrollY&&(a.y+=r.scrollY);return a}onClick(t){var{x:e,y:r}=this.mapXY(t.clientX,t.clientY);this.events.push({type:"onclick",x:e,y:r,run(t){t.onClick&&t.onClick()}})}onMouseMove(t){var{x:e,y:r}=this.mapXY(t.clientX,t.clientY);this.events.push({type:"onmousemove",x:e,y:r,run(t){t.onMouseMove&&t.onMouseMove()}})}}var y="undefined"!==typeof window?window:null;var x="undefined"!==typeof fetch?fetch.bind(void 0):null;class Screen{constructor(t){var{fetch:e=x,window:r=y}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.ctx=t;this.FRAMERATE=30;this.MAX_VIRTUAL_PIXELS=3e4;this.CLIENT_WIDTH=800;this.CLIENT_HEIGHT=600;this.viewPort=new ViewPort;this.mouse=new Mouse(this);this.animations=[];this.waits=[];this.frameDuration=0;this.isReadyLock=false;this.isFirstRender=true;this.intervalId=null;this.window=r;this.fetch=e}wait(t){this.waits.push(t)}ready(){return this.readyPromise?this.readyPromise:Promise.resolve()}isReady(){if(this.isReadyLock)return true;var t=this.waits.every((t=>t()));if(t){this.waits=[];this.resolveReady&&this.resolveReady()}this.isReadyLock=t;return t}setDefaults(t){t.strokeStyle="rgba(0,0,0,0)";t.lineCap="butt";t.lineJoin="miter";t.miterLimit=4}setViewBox(t){var{document:e,ctx:r,aspectRatio:i,width:a,desiredWidth:s,height:n,desiredHeight:o,minX:h=0,minY:l=0,refX:u,refY:g,clip:d=false,clipX:v=0,clipY:p=0}=t;var f=compressSpaces(i).replace(/^defer\s/,"");var[y,x]=f.split(" ");var P=y||"xMidYMid";var b=x||"meet";var S=a/s;var E=n/o;var w=Math.min(S,E);var C=Math.max(S,E);var A=s;var T=o;if("meet"===b){A*=w;T*=w}if("slice"===b){A*=C;T*=C}var M=new Property(e,"refX",u);var V=new Property(e,"refY",g);var k=M.hasValue()&&V.hasValue();k&&r.translate(-w*M.getPixels("x"),-w*V.getPixels("y"));if(d){var O=w*v;var B=w*p;r.beginPath();r.moveTo(O,B);r.lineTo(a,B);r.lineTo(a,n);r.lineTo(O,n);r.closePath();r.clip()}if(!k){var N="meet"===b&&w===E;var D="slice"===b&&C===E;var F="meet"===b&&w===S;var R="slice"===b&&C===S;P.startsWith("xMid")&&(N||D)&&r.translate(a/2-A/2,0);P.endsWith("YMid")&&(F||R)&&r.translate(0,n/2-T/2);P.startsWith("xMax")&&(N||D)&&r.translate(a-A,0);P.endsWith("YMax")&&(F||R)&&r.translate(0,n-T)}switch(true){case"none"===P:r.scale(S,E);break;case"meet"===b:r.scale(w,w);break;case"slice"===b:r.scale(C,C);break}r.translate(-h,-l)}start(t){var{enableRedraw:e=false,ignoreMouse:i=false,ignoreAnimation:a=false,ignoreDimensions:s=false,ignoreClear:n=false,forceRedraw:o,scaleWidth:h,scaleHeight:l,offsetX:u,offsetY:g}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};var{FRAMERATE:d,mouse:v}=this;var p=1e3/d;this.frameDuration=p;this.readyPromise=new Promise((t=>{this.resolveReady=t}));this.isReady()&&this.render(t,s,n,h,l,u,g);if(e){var f=Date.now();var y=f;var x=0;var tick=()=>{f=Date.now();x=f-y;if(x>=p){y=f-x%p;if(this.shouldUpdate(a,o)){this.render(t,s,n,h,l,u,g);v.runEvents()}}this.intervalId=r(tick)};i||v.start();this.intervalId=r(tick)}}stop(){if(this.intervalId){r.cancel(this.intervalId);this.intervalId=null}this.mouse.stop()}shouldUpdate(t,e){if(!t){var{frameDuration:r}=this;var i=this.animations.reduce(((t,e)=>e.update(r)||t),false);if(i)return true}return!("function"!==typeof e||!e())||(!(this.isReadyLock||!this.isReady())||!!this.mouse.hasEvents())}render(t,e,r,i,a,s,n){var{CLIENT_WIDTH:o,CLIENT_HEIGHT:h,viewPort:l,ctx:u,isFirstRender:g}=this;var d=u.canvas;l.clear();d.width&&d.height?l.setCurrent(d.width,d.height):l.setCurrent(o,h);var v=t.getStyle("width");var p=t.getStyle("height");if(!e&&(g||"number"!==typeof i&&"number"!==typeof a)){if(v.hasValue()){d.width=v.getPixels("x");d.style&&(d.style.width="".concat(d.width,"px"))}if(p.hasValue()){d.height=p.getPixels("y");d.style&&(d.style.height="".concat(d.height,"px"))}}var f=d.clientWidth||d.width;var y=d.clientHeight||d.height;if(e&&v.hasValue()&&p.hasValue()){f=v.getPixels("x");y=p.getPixels("y")}l.setCurrent(f,y);"number"===typeof s&&t.getAttribute("x",true).setValue(s);"number"===typeof n&&t.getAttribute("y",true).setValue(n);if("number"===typeof i||"number"===typeof a){var x=toNumbers(t.getAttribute("viewBox").getString());var P=0;var b=0;if("number"===typeof i){var S=t.getStyle("width");S.hasValue()?P=S.getPixels("x")/i:isNaN(x[2])||(P=x[2]/i)}if("number"===typeof a){var E=t.getStyle("height");E.hasValue()?b=E.getPixels("y")/a:isNaN(x[3])||(b=x[3]/a)}P||(P=b);b||(b=P);t.getAttribute("width",true).setValue(i);t.getAttribute("height",true).setValue(a);var w=t.getStyle("transform",true,true);w.setValue("".concat(w.getString()," scale(").concat(1/P,", ").concat(1/b,")"))}r||u.clearRect(0,0,f,y);t.render(u);g&&(this.isFirstRender=false)}}Screen.defaultWindow=y;Screen.defaultFetch=x;var{defaultFetch:P}=Screen;var b="undefined"!==typeof DOMParser?DOMParser:null;class Parser{constructor(){var{fetch:t=P,DOMParser:e=b}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.fetch=t;this.DOMParser=e}parse(e){var r=this;return t((function*(){return e.startsWith("<")?r.parseFromString(e):r.load(e)}))()}parseFromString(t){var e=new this.DOMParser;try{return this.checkDocument(e.parseFromString(t,"image/svg+xml"))}catch(r){return this.checkDocument(e.parseFromString(t,"text/xml"))}}checkDocument(t){var e=t.getElementsByTagName("parsererror")[0];if(e)throw new Error(e.textContent);return t}load(e){var r=this;return t((function*(){var t=yield r.fetch(e);var i=yield t.text();return r.parseFromString(i)}))()}}class Translate{constructor(t,e){this.type="translate";this.point=null;this.point=Point.parse(e)}apply(t){var{x:e,y:r}=this.point;t.translate(e||0,r||0)}unapply(t){var{x:e,y:r}=this.point;t.translate(-1*e||0,-1*r||0)}applyToPoint(t){var{x:e,y:r}=this.point;t.applyTransform([1,0,0,1,e||0,r||0])}}class Rotate{constructor(t,e,r){this.type="rotate";this.angle=null;this.originX=null;this.originY=null;this.cx=0;this.cy=0;var i=toNumbers(e);this.angle=new Property(t,"angle",i[0]);this.originX=r[0];this.originY=r[1];this.cx=i[1]||0;this.cy=i[2]||0}apply(t){var{cx:e,cy:r,originX:i,originY:a,angle:s}=this;var n=e+i.getPixels("x");var o=r+a.getPixels("y");t.translate(n,o);t.rotate(s.getRadians());t.translate(-n,-o)}unapply(t){var{cx:e,cy:r,originX:i,originY:a,angle:s}=this;var n=e+i.getPixels("x");var o=r+a.getPixels("y");t.translate(n,o);t.rotate(-1*s.getRadians());t.translate(-n,-o)}applyToPoint(t){var{cx:e,cy:r,angle:i}=this;var a=i.getRadians();t.applyTransform([1,0,0,1,e||0,r||0]);t.applyTransform([Math.cos(a),Math.sin(a),-Math.sin(a),Math.cos(a),0,0]);t.applyTransform([1,0,0,1,-e||0,-r||0])}}class Scale{constructor(t,e,r){this.type="scale";this.scale=null;this.originX=null;this.originY=null;var i=Point.parseScale(e);if(0===i.x||0===i.y){i.x=f;i.y=f}this.scale=i;this.originX=r[0];this.originY=r[1]}apply(t){var{scale:{x:e,y:r},originX:i,originY:a}=this;var s=i.getPixels("x");var n=a.getPixels("y");t.translate(s,n);t.scale(e,r||e);t.translate(-s,-n)}unapply(t){var{scale:{x:e,y:r},originX:i,originY:a}=this;var s=i.getPixels("x");var n=a.getPixels("y");t.translate(s,n);t.scale(1/e,1/r||e);t.translate(-s,-n)}applyToPoint(t){var{x:e,y:r}=this.scale;t.applyTransform([e||0,0,0,r||0,0,0])}}class Matrix{constructor(t,e,r){this.type="matrix";this.matrix=[];this.originX=null;this.originY=null;this.matrix=toNumbers(e);this.originX=r[0];this.originY=r[1]}apply(t){var{originX:e,originY:r,matrix:i}=this;var a=e.getPixels("x");var s=r.getPixels("y");t.translate(a,s);t.transform(i[0],i[1],i[2],i[3],i[4],i[5]);t.translate(-a,-s)}unapply(t){var{originX:e,originY:r,matrix:i}=this;var a=i[0];var s=i[2];var n=i[4];var o=i[1];var h=i[3];var l=i[5];var u=0;var g=0;var d=1;var v=1/(a*(h*d-l*g)-s*(o*d-l*u)+n*(o*g-h*u));var p=e.getPixels("x");var f=r.getPixels("y");t.translate(p,f);t.transform(v*(h*d-l*g),v*(l*u-o*d),v*(n*g-s*d),v*(a*d-n*u),v*(s*l-n*h),v*(n*o-a*l));t.translate(-p,-f)}applyToPoint(t){t.applyTransform(this.matrix)}}class Skew extends Matrix{constructor(t,e,r){super(t,e,r);this.type="skew";this.angle=null;this.angle=new Property(t,"angle",e)}}class SkewX extends Skew{constructor(t,e,r){super(t,e,r);this.type="skewX";this.matrix=[1,0,Math.tan(this.angle.getRadians()),1,0,0]}}class SkewY extends Skew{constructor(t,e,r){super(t,e,r);this.type="skewY";this.matrix=[1,Math.tan(this.angle.getRadians()),0,1,0,0]}}function parseTransforms(t){return compressSpaces(t).trim().replace(/\)([a-zA-Z])/g,") $1").replace(/\)(\s?,\s?)/g,") ").split(/\s(?=[a-z])/)}function parseTransform(t){var[e,r]=t.split("(");return[e.trim(),r.trim().replace(")","")]}class Transform{constructor(t,e,r){this.document=t;this.transforms=[];var i=parseTransforms(e);i.forEach((t=>{if("none"!==t){var[e,i]=parseTransform(t);var a=Transform.transformTypes[e];"undefined"!==typeof a&&this.transforms.push(new a(this.document,i,r))}}))}static fromElement(t,e){var r=e.getStyle("transform",false,true);var[i,a=i]=e.getStyle("transform-origin",false,true).split();var s=[i,a];return r.hasValue()?new Transform(t,r.getString(),s):null}apply(t){var{transforms:e}=this;var r=e.length;for(var i=0;i<r;i++)e[i].apply(t)}unapply(t){var{transforms:e}=this;var r=e.length;for(var i=r-1;i>=0;i--)e[i].unapply(t)}applyToPoint(t){var{transforms:e}=this;var r=e.length;for(var i=0;i<r;i++)e[i].applyToPoint(t)}}Transform.transformTypes={translate:Translate,rotate:Rotate,scale:Scale,matrix:Matrix,skewX:SkewX,skewY:SkewY};class Element{constructor(t,e){var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this.document=t;this.node=e;this.captureTextNodes=r;this.attributes={};this.styles={};this.stylesSpecificity={};this.animationFrozen=false;this.animationFrozenValue="";this.parent=null;this.children=[];if(e&&1===e.nodeType){Array.from(e.attributes).forEach((e=>{var r=normalizeAttributeName(e.nodeName);this.attributes[r]=new Property(t,r,e.value)}));this.addStylesFromStyleDefinition();if(this.getAttribute("style").hasValue()){var i=this.getAttribute("style").getString().split(";").map((t=>t.trim()));i.forEach((e=>{if(e){var[r,i]=e.split(":").map((t=>t.trim()));this.styles[r]=new Property(t,r,i)}}))}var{definitions:a}=t;var s=this.getAttribute("id");s.hasValue()&&(a[s.getString()]||(a[s.getString()]=this));Array.from(e.childNodes).forEach((e=>{if(1===e.nodeType)this.addChild(e);else if(r&&(3===e.nodeType||4===e.nodeType)){var i=t.createTextNode(e);i.getText().length>0&&this.addChild(i)}}))}}getAttribute(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];var r=this.attributes[t];if(!r&&e){var i=new Property(this.document,t,"");this.attributes[t]=i;return i}return r||Property.empty(this.document)}getHrefAttribute(){for(var t in this.attributes)if("href"===t||t.endsWith(":href"))return this.attributes[t];return Property.empty(this.document)}getStyle(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];var i=this.styles[t];if(i)return i;var a=this.getAttribute(t);if(null!==a&&void 0!==a&&a.hasValue()){this.styles[t]=a;return a}if(!r){var{parent:s}=this;if(s){var n=s.getStyle(t);if(null!==n&&void 0!==n&&n.hasValue())return n}}if(e){var o=new Property(this.document,t,"");this.styles[t]=o;return o}return i||Property.empty(this.document)}render(t){if("none"!==this.getStyle("display").getString()&&"hidden"!==this.getStyle("visibility").getString()){t.save();if(this.getStyle("mask").hasValue()){var e=this.getStyle("mask").getDefinition();if(e){this.applyEffects(t);e.apply(t,this)}}else if("none"!==this.getStyle("filter").getValue("none")){var r=this.getStyle("filter").getDefinition();if(r){this.applyEffects(t);r.apply(t,this)}}else{this.setContext(t);this.renderChildren(t);this.clearContext(t)}t.restore()}}setContext(t){}applyEffects(t){var e=Transform.fromElement(this.document,this);e&&e.apply(t);var r=this.getStyle("clip-path",false,true);if(r.hasValue()){var i=r.getDefinition();i&&i.apply(t)}}clearContext(t){}renderChildren(t){this.children.forEach((e=>{e.render(t)}))}addChild(t){var e=t instanceof Element?t:this.document.createElement(t);e.parent=this;Element.ignoreChildTypes.includes(e.type)||this.children.push(e)}matchesSelector(t){var e;var{node:r}=this;if("function"===typeof r.matches)return r.matches(t);var i=null===(e=r.getAttribute)||void 0===e?void 0:e.call(r,"class");return!(!i||""===i)&&i.split(" ").some((e=>".".concat(e)===t))}addStylesFromStyleDefinition(){var{styles:t,stylesSpecificity:e}=this.document;for(var r in t)if(!r.startsWith("@")&&this.matchesSelector(r)){var i=t[r];var a=e[r];if(i)for(var s in i){var n=this.stylesSpecificity[s];"undefined"===typeof n&&(n="000");if(a>=n){this.styles[s]=i[s];this.stylesSpecificity[s]=a}}}}removeStyles(t,e){var r=e.reduce(((e,r)=>{var i=t.getStyle(r);if(!i.hasValue())return e;var a=i.getString();i.setValue("");return[...e,[r,a]]}),[]);return r}restoreStyles(t,e){e.forEach((e=>{var[r,i]=e;t.getStyle(r,true).setValue(i)}))}isFirstChild(){var t;return 0===(null===(t=this.parent)||void 0===t?void 0:t.children.indexOf(this))}}Element.ignoreChildTypes=["title"];class UnknownElement extends Element{constructor(t,e,r){super(t,e,r)}}function wrapFontFamily(t){var e=t.trim();return/^('|")/.test(e)?e:'"'.concat(e,'"')}function prepareFontFamily(t){return"undefined"===typeof process?t:t.trim().split(",").map(wrapFontFamily).join(",")}
/**
 * https://developer.mozilla.org/en-US/docs/Web/CSS/font-style
 * @param fontStyle
 * @returns CSS font style.
 */function prepareFontStyle(t){if(!t)return"";var e=t.trim().toLowerCase();switch(e){case"normal":case"italic":case"oblique":case"inherit":case"initial":case"unset":return e;default:return/^oblique\s+(-|)\d+deg$/.test(e)?e:""}}
/**
 * https://developer.mozilla.org/en-US/docs/Web/CSS/font-weight
 * @param fontWeight
 * @returns CSS font weight.
 */function prepareFontWeight(t){if(!t)return"";var e=t.trim().toLowerCase();switch(e){case"normal":case"bold":case"lighter":case"bolder":case"inherit":case"initial":case"unset":return e;default:return/^[\d.]+$/.test(e)?e:""}}class Font{constructor(t,e,r,i,a,s){var n=s?"string"===typeof s?Font.parse(s):s:{};this.fontFamily=a||n.fontFamily;this.fontSize=i||n.fontSize;this.fontStyle=t||n.fontStyle;this.fontWeight=r||n.fontWeight;this.fontVariant=e||n.fontVariant}static parse(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";var e=arguments.length>1?arguments[1]:void 0;var r="";var i="";var a="";var s="";var n="";var o=compressSpaces(t).trim().split(" ");var h={fontSize:false,fontStyle:false,fontWeight:false,fontVariant:false};o.forEach((t=>{switch(true){case!h.fontStyle&&Font.styles.includes(t):"inherit"!==t&&(r=t);h.fontStyle=true;break;case!h.fontVariant&&Font.variants.includes(t):"inherit"!==t&&(i=t);h.fontStyle=true;h.fontVariant=true;break;case!h.fontWeight&&Font.weights.includes(t):"inherit"!==t&&(a=t);h.fontStyle=true;h.fontVariant=true;h.fontWeight=true;break;case!h.fontSize:"inherit"!==t&&([s]=t.split("/"));h.fontStyle=true;h.fontVariant=true;h.fontWeight=true;h.fontSize=true;break;default:"inherit"!==t&&(n+=t)}}));return new Font(r,i,a,s,n,e)}toString(){return[prepareFontStyle(this.fontStyle),this.fontVariant,prepareFontWeight(this.fontWeight),this.fontSize,prepareFontFamily(this.fontFamily)].join(" ").trim()}}Font.styles="normal|italic|oblique|inherit";Font.variants="normal|small-caps|inherit";Font.weights="normal|bold|bolder|lighter|100|200|300|400|500|600|700|800|900|inherit";class BoundingBox{constructor(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Number.NaN;var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Number.NaN;var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Number.NaN;var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:Number.NaN;this.x1=t;this.y1=e;this.x2=r;this.y2=i;this.addPoint(t,e);this.addPoint(r,i)}get x(){return this.x1}get y(){return this.y1}get width(){return this.x2-this.x1}get height(){return this.y2-this.y1}addPoint(t,e){if("undefined"!==typeof t){if(isNaN(this.x1)||isNaN(this.x2)){this.x1=t;this.x2=t}t<this.x1&&(this.x1=t);t>this.x2&&(this.x2=t)}if("undefined"!==typeof e){if(isNaN(this.y1)||isNaN(this.y2)){this.y1=e;this.y2=e}e<this.y1&&(this.y1=e);e>this.y2&&(this.y2=e)}}addX(t){this.addPoint(t,null)}addY(t){this.addPoint(null,t)}addBoundingBox(t){if(t){var{x1:e,y1:r,x2:i,y2:a}=t;this.addPoint(e,r);this.addPoint(i,a)}}sumCubic(t,e,r,i,a){return Math.pow(1-t,3)*e+3*Math.pow(1-t,2)*t*r+3*(1-t)*Math.pow(t,2)*i+Math.pow(t,3)*a}bezierCurveAdd(t,e,r,i,a){var s=6*e-12*r+6*i;var n=-3*e+9*r-9*i+3*a;var o=3*r-3*e;if(0!==n){var h=Math.pow(s,2)-4*o*n;if(!(h<0)){var l=(-s+Math.sqrt(h))/(2*n);0<l&&l<1&&(t?this.addX(this.sumCubic(l,e,r,i,a)):this.addY(this.sumCubic(l,e,r,i,a)));var u=(-s-Math.sqrt(h))/(2*n);0<u&&u<1&&(t?this.addX(this.sumCubic(u,e,r,i,a)):this.addY(this.sumCubic(u,e,r,i,a)))}}else{if(0===s)return;var g=-o/s;0<g&&g<1&&(t?this.addX(this.sumCubic(g,e,r,i,a)):this.addY(this.sumCubic(g,e,r,i,a)))}}addBezierCurve(t,e,r,i,a,s,n,o){this.addPoint(t,e);this.addPoint(n,o);this.bezierCurveAdd(true,t,r,a,n);this.bezierCurveAdd(false,e,i,s,o)}addQuadraticCurve(t,e,r,i,a,s){var n=t+2/3*(r-t);var o=e+2/3*(i-e);var h=n+1/3*(a-t);var l=o+1/3*(s-e);this.addBezierCurve(t,e,n,h,o,l,a,s)}isPointInBox(t,e){var{x1:r,y1:i,x2:a,y2:s}=this;return r<=t&&t<=a&&i<=e&&e<=s}}class PathParser extends a{constructor(t){super(t.replace(/([+\-.])\s+/gm,"$1").replace(/[^MmZzLlHhVvCcSsQqTtAae\d\s.,+-].*/g,""));this.control=null;this.start=null;this.current=null;this.command=null;this.commands=this.commands;this.i=-1;this.previousCommand=null;this.points=[];this.angles=[]}reset(){this.i=-1;this.command=null;this.previousCommand=null;this.start=new Point(0,0);this.control=new Point(0,0);this.current=new Point(0,0);this.points=[];this.angles=[]}isEnd(){var{i:t,commands:e}=this;return t>=e.length-1}next(){var t=this.commands[++this.i];this.previousCommand=this.command;this.command=t;return t}getPoint(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"x";var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"y";var r=new Point(this.command[t],this.command[e]);return this.makeAbsolute(r)}getAsControlPoint(t,e){var r=this.getPoint(t,e);this.control=r;return r}getAsCurrentPoint(t,e){var r=this.getPoint(t,e);this.current=r;return r}getReflectedControlPoint(){var t=this.previousCommand.type;if(t!==a.CURVE_TO&&t!==a.SMOOTH_CURVE_TO&&t!==a.QUAD_TO&&t!==a.SMOOTH_QUAD_TO)return this.current;var{current:{x:e,y:r},control:{x:i,y:s}}=this;var n=new Point(2*e-i,2*r-s);return n}makeAbsolute(t){if(this.command.relative){var{x:e,y:r}=this.current;t.x+=e;t.y+=r}return t}addMarker(t,e,r){var{points:i,angles:a}=this;r&&a.length>0&&!a[a.length-1]&&(a[a.length-1]=i[i.length-1].angleTo(r));this.addMarkerAngle(t,e?e.angleTo(t):null)}addMarkerAngle(t,e){this.points.push(t);this.angles.push(e)}getMarkerPoints(){return this.points}getMarkerAngles(){var{angles:t}=this;var e=t.length;for(var r=0;r<e;r++)if(!t[r])for(var i=r+1;i<e;i++)if(t[i]){t[r]=t[i];break}return t}}class RenderedElement extends Element{constructor(){super(...arguments);this.modifiedEmSizeStack=false}calculateOpacity(){var t=1;var e=this;while(e){var r=e.getStyle("opacity",false,true);r.hasValue(true)&&(t*=r.getNumber());e=e.parent}return t}setContext(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!e){var r=this.getStyle("fill");var i=this.getStyle("fill-opacity");var a=this.getStyle("stroke");var s=this.getStyle("stroke-opacity");if(r.isUrlDefinition()){var n=r.getFillStyleDefinition(this,i);n&&(t.fillStyle=n)}else if(r.hasValue()){"currentColor"===r.getString()&&r.setValue(this.getStyle("color").getColor());var o=r.getColor();"inherit"!==o&&(t.fillStyle="none"===o?"rgba(0,0,0,0)":o)}if(i.hasValue()){var h=new Property(this.document,"fill",t.fillStyle).addOpacity(i).getColor();t.fillStyle=h}if(a.isUrlDefinition()){var l=a.getFillStyleDefinition(this,s);l&&(t.strokeStyle=l)}else if(a.hasValue()){"currentColor"===a.getString()&&a.setValue(this.getStyle("color").getColor());var u=a.getString();"inherit"!==u&&(t.strokeStyle="none"===u?"rgba(0,0,0,0)":u)}if(s.hasValue()){var g=new Property(this.document,"stroke",t.strokeStyle).addOpacity(s).getString();t.strokeStyle=g}var d=this.getStyle("stroke-width");if(d.hasValue()){var v=d.getPixels();t.lineWidth=v||f}var p=this.getStyle("stroke-linecap");var y=this.getStyle("stroke-linejoin");var x=this.getStyle("stroke-miterlimit");var P=this.getStyle("stroke-dasharray");var b=this.getStyle("stroke-dashoffset");p.hasValue()&&(t.lineCap=p.getString());y.hasValue()&&(t.lineJoin=y.getString());x.hasValue()&&(t.miterLimit=x.getNumber());if(P.hasValue()&&"none"!==P.getString()){var S=toNumbers(P.getString());"undefined"!==typeof t.setLineDash?t.setLineDash(S):"undefined"!==typeof t.webkitLineDash?t.webkitLineDash=S:"undefined"===typeof t.mozDash||1===S.length&&0===S[0]||(t.mozDash=S);var E=b.getPixels();"undefined"!==typeof t.lineDashOffset?t.lineDashOffset=E:"undefined"!==typeof t.webkitLineDashOffset?t.webkitLineDashOffset=E:"undefined"!==typeof t.mozDashOffset&&(t.mozDashOffset=E)}}this.modifiedEmSizeStack=false;if("undefined"!==typeof t.font){var w=this.getStyle("font");var C=this.getStyle("font-style");var A=this.getStyle("font-variant");var T=this.getStyle("font-weight");var M=this.getStyle("font-size");var V=this.getStyle("font-family");var k=new Font(C.getString(),A.getString(),T.getString(),M.hasValue()?"".concat(M.getPixels(true),"px"):"",V.getString(),Font.parse(w.getString(),t.font));C.setValue(k.fontStyle);A.setValue(k.fontVariant);T.setValue(k.fontWeight);M.setValue(k.fontSize);V.setValue(k.fontFamily);t.font=k.toString();if(M.isPixels()){this.document.emSize=M.getPixels();this.modifiedEmSizeStack=true}}if(!e){this.applyEffects(t);t.globalAlpha=this.calculateOpacity()}}clearContext(t){super.clearContext(t);this.modifiedEmSizeStack&&this.document.popEmSize()}}class PathElement extends RenderedElement{constructor(t,e,r){super(t,e,r);this.type="path";this.pathParser=null;this.pathParser=new PathParser(this.getAttribute("d").getString())}path(t){var{pathParser:e}=this;var r=new BoundingBox;e.reset();t&&t.beginPath();while(!e.isEnd())switch(e.next().type){case PathParser.MOVE_TO:this.pathM(t,r);break;case PathParser.LINE_TO:this.pathL(t,r);break;case PathParser.HORIZ_LINE_TO:this.pathH(t,r);break;case PathParser.VERT_LINE_TO:this.pathV(t,r);break;case PathParser.CURVE_TO:this.pathC(t,r);break;case PathParser.SMOOTH_CURVE_TO:this.pathS(t,r);break;case PathParser.QUAD_TO:this.pathQ(t,r);break;case PathParser.SMOOTH_QUAD_TO:this.pathT(t,r);break;case PathParser.ARC:this.pathA(t,r);break;case PathParser.CLOSE_PATH:this.pathZ(t,r);break}return r}getBoundingBox(t){return this.path()}getMarkers(){var{pathParser:t}=this;var e=t.getMarkerPoints();var r=t.getMarkerAngles();var i=e.map(((t,e)=>[t,r[e]]));return i}renderChildren(t){this.path(t);this.document.screen.mouse.checkPath(this,t);var e=this.getStyle("fill-rule");""!==t.fillStyle&&("inherit"!==e.getString("inherit")?t.fill(e.getString()):t.fill());if(""!==t.strokeStyle)if("non-scaling-stroke"===this.getAttribute("vector-effect").getString()){t.save();t.setTransform(1,0,0,1,0,0);t.stroke();t.restore()}else t.stroke();var r=this.getMarkers();if(r){var i=r.length-1;var a=this.getStyle("marker-start");var s=this.getStyle("marker-mid");var n=this.getStyle("marker-end");if(a.isUrlDefinition()){var o=a.getDefinition();var[h,l]=r[0];o.render(t,h,l)}if(s.isUrlDefinition()){var u=s.getDefinition();for(var g=1;g<i;g++){var[d,v]=r[g];u.render(t,d,v)}}if(n.isUrlDefinition()){var p=n.getDefinition();var[f,y]=r[i];p.render(t,f,y)}}}static pathM(t){var e=t.getAsCurrentPoint();t.start=t.current;return{point:e}}pathM(t,e){var{pathParser:r}=this;var{point:i}=PathElement.pathM(r);var{x:a,y:s}=i;r.addMarker(i);e.addPoint(a,s);t&&t.moveTo(a,s)}static pathL(t){var{current:e}=t;var r=t.getAsCurrentPoint();return{current:e,point:r}}pathL(t,e){var{pathParser:r}=this;var{current:i,point:a}=PathElement.pathL(r);var{x:s,y:n}=a;r.addMarker(a,i);e.addPoint(s,n);t&&t.lineTo(s,n)}static pathH(t){var{current:e,command:r}=t;var i=new Point((r.relative?e.x:0)+r.x,e.y);t.current=i;return{current:e,point:i}}pathH(t,e){var{pathParser:r}=this;var{current:i,point:a}=PathElement.pathH(r);var{x:s,y:n}=a;r.addMarker(a,i);e.addPoint(s,n);t&&t.lineTo(s,n)}static pathV(t){var{current:e,command:r}=t;var i=new Point(e.x,(r.relative?e.y:0)+r.y);t.current=i;return{current:e,point:i}}pathV(t,e){var{pathParser:r}=this;var{current:i,point:a}=PathElement.pathV(r);var{x:s,y:n}=a;r.addMarker(a,i);e.addPoint(s,n);t&&t.lineTo(s,n)}static pathC(t){var{current:e}=t;var r=t.getPoint("x1","y1");var i=t.getAsControlPoint("x2","y2");var a=t.getAsCurrentPoint();return{current:e,point:r,controlPoint:i,currentPoint:a}}pathC(t,e){var{pathParser:r}=this;var{current:i,point:a,controlPoint:s,currentPoint:n}=PathElement.pathC(r);r.addMarker(n,s,a);e.addBezierCurve(i.x,i.y,a.x,a.y,s.x,s.y,n.x,n.y);t&&t.bezierCurveTo(a.x,a.y,s.x,s.y,n.x,n.y)}static pathS(t){var{current:e}=t;var r=t.getReflectedControlPoint();var i=t.getAsControlPoint("x2","y2");var a=t.getAsCurrentPoint();return{current:e,point:r,controlPoint:i,currentPoint:a}}pathS(t,e){var{pathParser:r}=this;var{current:i,point:a,controlPoint:s,currentPoint:n}=PathElement.pathS(r);r.addMarker(n,s,a);e.addBezierCurve(i.x,i.y,a.x,a.y,s.x,s.y,n.x,n.y);t&&t.bezierCurveTo(a.x,a.y,s.x,s.y,n.x,n.y)}static pathQ(t){var{current:e}=t;var r=t.getAsControlPoint("x1","y1");var i=t.getAsCurrentPoint();return{current:e,controlPoint:r,currentPoint:i}}pathQ(t,e){var{pathParser:r}=this;var{current:i,controlPoint:a,currentPoint:s}=PathElement.pathQ(r);r.addMarker(s,a,a);e.addQuadraticCurve(i.x,i.y,a.x,a.y,s.x,s.y);t&&t.quadraticCurveTo(a.x,a.y,s.x,s.y)}static pathT(t){var{current:e}=t;var r=t.getReflectedControlPoint();t.control=r;var i=t.getAsCurrentPoint();return{current:e,controlPoint:r,currentPoint:i}}pathT(t,e){var{pathParser:r}=this;var{current:i,controlPoint:a,currentPoint:s}=PathElement.pathT(r);r.addMarker(s,a,a);e.addQuadraticCurve(i.x,i.y,a.x,a.y,s.x,s.y);t&&t.quadraticCurveTo(a.x,a.y,s.x,s.y)}static pathA(t){var{current:e,command:r}=t;var{rX:i,rY:a,xRot:s,lArcFlag:n,sweepFlag:o}=r;var h=s*(Math.PI/180);var l=t.getAsCurrentPoint();var u=new Point(Math.cos(h)*(e.x-l.x)/2+Math.sin(h)*(e.y-l.y)/2,-Math.sin(h)*(e.x-l.x)/2+Math.cos(h)*(e.y-l.y)/2);var g=Math.pow(u.x,2)/Math.pow(i,2)+Math.pow(u.y,2)/Math.pow(a,2);if(g>1){i*=Math.sqrt(g);a*=Math.sqrt(g)}var d=(n===o?-1:1)*Math.sqrt((Math.pow(i,2)*Math.pow(a,2)-Math.pow(i,2)*Math.pow(u.y,2)-Math.pow(a,2)*Math.pow(u.x,2))/(Math.pow(i,2)*Math.pow(u.y,2)+Math.pow(a,2)*Math.pow(u.x,2)));isNaN(d)&&(d=0);var v=new Point(d*i*u.y/a,d*-a*u.x/i);var p=new Point((e.x+l.x)/2+Math.cos(h)*v.x-Math.sin(h)*v.y,(e.y+l.y)/2+Math.sin(h)*v.x+Math.cos(h)*v.y);var f=vectorsAngle([1,0],[(u.x-v.x)/i,(u.y-v.y)/a]);var y=[(u.x-v.x)/i,(u.y-v.y)/a];var x=[(-u.x-v.x)/i,(-u.y-v.y)/a];var P=vectorsAngle(y,x);vectorsRatio(y,x)<=-1&&(P=Math.PI);vectorsRatio(y,x)>=1&&(P=0);return{currentPoint:l,rX:i,rY:a,sweepFlag:o,xAxisRotation:h,centp:p,a1:f,ad:P}}pathA(t,e){var{pathParser:r}=this;var{currentPoint:i,rX:a,rY:s,sweepFlag:n,xAxisRotation:o,centp:h,a1:l,ad:u}=PathElement.pathA(r);var g=1-n?1:-1;var d=l+g*(u/2);var v=new Point(h.x+a*Math.cos(d),h.y+s*Math.sin(d));r.addMarkerAngle(v,d-g*Math.PI/2);r.addMarkerAngle(i,d-g*Math.PI);e.addPoint(i.x,i.y);if(t&&!isNaN(l)&&!isNaN(u)){var p=a>s?a:s;var f=a>s?1:a/s;var y=a>s?s/a:1;t.translate(h.x,h.y);t.rotate(o);t.scale(f,y);t.arc(0,0,p,l,l+u,Boolean(1-n));t.scale(1/f,1/y);t.rotate(-o);t.translate(-h.x,-h.y)}}static pathZ(t){t.current=t.start}pathZ(t,e){PathElement.pathZ(this.pathParser);t&&e.x1!==e.x2&&e.y1!==e.y2&&t.closePath()}}class GlyphElement extends PathElement{constructor(t,e,r){super(t,e,r);this.type="glyph";this.horizAdvX=this.getAttribute("horiz-adv-x").getNumber();this.unicode=this.getAttribute("unicode").getString();this.arabicForm=this.getAttribute("arabic-form").getString()}}class TextElement extends RenderedElement{constructor(t,e,r){super(t,e,new.target===TextElement||r);this.type="text";this.x=0;this.y=0;this.measureCache=-1}setContext(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];super.setContext(t,e);var r=this.getStyle("dominant-baseline").getTextBaseline()||this.getStyle("alignment-baseline").getTextBaseline();r&&(t.textBaseline=r)}initializeCoordinates(){this.x=0;this.y=0;this.leafTexts=[];this.textChunkStart=0;this.minX=Number.POSITIVE_INFINITY;this.maxX=Number.NEGATIVE_INFINITY}getBoundingBox(t){if("text"!==this.type)return this.getTElementBoundingBox(t);this.initializeCoordinates();this.adjustChildCoordinatesRecursive(t);var e=null;this.children.forEach(((r,i)=>{var a=this.getChildBoundingBox(t,this,this,i);e?e.addBoundingBox(a):e=a}));return e}getFontSize(){var{document:t,parent:e}=this;var r=Font.parse(t.ctx.font).fontSize;var i=e.getStyle("font-size").getNumber(r);return i}getTElementBoundingBox(t){var e=this.getFontSize();return new BoundingBox(this.x,this.y-e,this.x+this.measureText(t),this.y)}getGlyph(t,e,r){var i=e[r];var a=null;if(t.isArabic){var s=e.length;var n=e[r-1];var o=e[r+1];var h="isolated";(0===r||" "===n)&&r<s-1&&" "!==o&&(h="terminal");r>0&&" "!==n&&r<s-1&&" "!==o&&(h="medial");r>0&&" "!==n&&(r===s-1||" "===o)&&(h="initial");if("undefined"!==typeof t.glyphs[i]){var l=t.glyphs[i];a=l instanceof GlyphElement?l:l[h]}}else a=t.glyphs[i];a||(a=t.missingGlyph);return a}getText(){return""}getTextFromNode(t){var e=t||this.node;var r=Array.from(e.parentNode.childNodes);var i=r.indexOf(e);var a=r.length-1;var s=compressSpaces(e.textContent||"");0===i&&(s=trimLeft(s));i===a&&(s=trimRight(s));return s}renderChildren(t){if("text"===this.type){this.initializeCoordinates();this.adjustChildCoordinatesRecursive(t);this.children.forEach(((e,r)=>{this.renderChild(t,this,this,r)}));var{mouse:e}=this.document.screen;e.isWorking()&&e.checkBoundingBox(this,this.getBoundingBox(t))}else this.renderTElementChildren(t)}renderTElementChildren(t){var{document:e,parent:r}=this;var i=this.getText();var a=r.getStyle("font-family").getDefinition();if(a){var{unitsPerEm:s}=a.fontFace;var n=Font.parse(e.ctx.font);var o=r.getStyle("font-size").getNumber(n.fontSize);var h=r.getStyle("font-style").getString(n.fontStyle);var l=o/s;var u=a.isRTL?i.split("").reverse().join(""):i;var g=toNumbers(r.getAttribute("dx").getString());var d=u.length;for(var v=0;v<d;v++){var p=this.getGlyph(a,u,v);t.translate(this.x,this.y);t.scale(l,-l);var f=t.lineWidth;t.lineWidth=t.lineWidth*s/o;"italic"===h&&t.transform(1,0,.4,1,0,0);p.render(t);"italic"===h&&t.transform(1,0,-.4,1,0,0);t.lineWidth=f;t.scale(1/l,-1/l);t.translate(-this.x,-this.y);this.x+=o*(p.horizAdvX||a.horizAdvX)/s;"undefined"===typeof g[v]||isNaN(g[v])||(this.x+=g[v])}}else{var{x:y,y:x}=this;t.fillStyle&&t.fillText(i,y,x);t.strokeStyle&&t.strokeText(i,y,x)}}applyAnchoring(){if(!(this.textChunkStart>=this.leafTexts.length)){var t=this.leafTexts[this.textChunkStart];var e=t.getStyle("text-anchor").getString("start");var r=false;var i=0;i="start"===e&&!r||"end"===e&&r?t.x-this.minX:"end"===e&&!r||"start"===e&&r?t.x-this.maxX:t.x-(this.minX+this.maxX)/2;for(var a=this.textChunkStart;a<this.leafTexts.length;a++)this.leafTexts[a].x+=i;this.minX=Number.POSITIVE_INFINITY;this.maxX=Number.NEGATIVE_INFINITY;this.textChunkStart=this.leafTexts.length}}adjustChildCoordinatesRecursive(t){this.children.forEach(((e,r)=>{this.adjustChildCoordinatesRecursiveCore(t,this,this,r)}));this.applyAnchoring()}adjustChildCoordinatesRecursiveCore(t,e,r,i){var a=r.children[i];a.children.length>0?a.children.forEach(((r,i)=>{e.adjustChildCoordinatesRecursiveCore(t,e,a,i)})):this.adjustChildCoordinates(t,e,r,i)}adjustChildCoordinates(t,e,r,i){var a=r.children[i];if("function"!==typeof a.measureText)return a;t.save();a.setContext(t,true);var s=a.getAttribute("x");var n=a.getAttribute("y");var o=a.getAttribute("dx");var h=a.getAttribute("dy");var l=a.getStyle("font-family").getDefinition();var u=Boolean(l)&&l.isRTL;if(0===i){s.hasValue()||s.setValue(a.getInheritedAttribute("x"));n.hasValue()||n.setValue(a.getInheritedAttribute("y"));o.hasValue()||o.setValue(a.getInheritedAttribute("dx"));h.hasValue()||h.setValue(a.getInheritedAttribute("dy"))}var g=a.measureText(t);u&&(e.x-=g);if(s.hasValue()){e.applyAnchoring();a.x=s.getPixels("x");o.hasValue()&&(a.x+=o.getPixels("x"))}else{o.hasValue()&&(e.x+=o.getPixels("x"));a.x=e.x}e.x=a.x;u||(e.x+=g);if(n.hasValue()){a.y=n.getPixels("y");h.hasValue()&&(a.y+=h.getPixels("y"))}else{h.hasValue()&&(e.y+=h.getPixels("y"));a.y=e.y}e.y=a.y;e.leafTexts.push(a);e.minX=Math.min(e.minX,a.x,a.x+g);e.maxX=Math.max(e.maxX,a.x,a.x+g);a.clearContext(t);t.restore();return a}getChildBoundingBox(t,e,r,i){var a=r.children[i];if("function"!==typeof a.getBoundingBox)return null;var s=a.getBoundingBox(t);if(!s)return null;a.children.forEach(((r,i)=>{var n=e.getChildBoundingBox(t,e,a,i);s.addBoundingBox(n)}));return s}renderChild(t,e,r,i){var a=r.children[i];a.render(t);a.children.forEach(((r,i)=>{e.renderChild(t,e,a,i)}))}measureText(t){var{measureCache:e}=this;if(~e)return e;var r=this.getText();var i=this.measureTargetText(t,r);this.measureCache=i;return i}measureTargetText(t,e){if(!e.length)return 0;var{parent:r}=this;var i=r.getStyle("font-family").getDefinition();if(i){var a=this.getFontSize();var s=i.isRTL?e.split("").reverse().join(""):e;var n=toNumbers(r.getAttribute("dx").getString());var o=s.length;var h=0;for(var l=0;l<o;l++){var u=this.getGlyph(i,s,l);h+=(u.horizAdvX||i.horizAdvX)*a/i.fontFace.unitsPerEm;"undefined"===typeof n[l]||isNaN(n[l])||(h+=n[l])}return h}if(!t.measureText)return 10*e.length;t.save();this.setContext(t,true);var{width:g}=t.measureText(e);this.clearContext(t);t.restore();return g}
/**
   * Inherits positional attributes from {@link TextElement} parent(s). Attributes
   * are only inherited from a parent to its first child.
   * @param name - The attribute name.
   * @returns The attribute value or null.
   */getInheritedAttribute(t){var e=this;while(e instanceof TextElement&&e.isFirstChild()){var r=e.parent.getAttribute(t);if(r.hasValue(true))return r.getValue("0");e=e.parent}return null}}class TSpanElement extends TextElement{constructor(t,e,r){super(t,e,new.target===TSpanElement||r);this.type="tspan";this.text=this.children.length>0?"":this.getTextFromNode()}getText(){return this.text}}class TextNode extends TSpanElement{constructor(){super(...arguments);this.type="textNode"}}class SVGElement extends RenderedElement{constructor(){super(...arguments);this.type="svg";this.root=false}setContext(t){var e;var{document:r}=this;var{screen:i,window:a}=r;var s=t.canvas;i.setDefaults(t);if(s.style&&"undefined"!==typeof t.font&&a&&"undefined"!==typeof a.getComputedStyle){t.font=a.getComputedStyle(s).getPropertyValue("font");var n=new Property(r,"fontSize",Font.parse(t.font).fontSize);if(n.hasValue()){r.rootEmSize=n.getPixels("y");r.emSize=r.rootEmSize}}this.getAttribute("x").hasValue()||this.getAttribute("x",true).setValue(0);this.getAttribute("y").hasValue()||this.getAttribute("y",true).setValue(0);var{width:o,height:h}=i.viewPort;this.getStyle("width").hasValue()||this.getStyle("width",true).setValue("100%");this.getStyle("height").hasValue()||this.getStyle("height",true).setValue("100%");this.getStyle("color").hasValue()||this.getStyle("color",true).setValue("black");var l=this.getAttribute("refX");var u=this.getAttribute("refY");var g=this.getAttribute("viewBox");var d=g.hasValue()?toNumbers(g.getString()):null;var v=!this.root&&"visible"!==this.getStyle("overflow").getValue("hidden");var p=0;var f=0;var y=0;var x=0;if(d){p=d[0];f=d[1]}if(!this.root){o=this.getStyle("width").getPixels("x");h=this.getStyle("height").getPixels("y");if("marker"===this.type){y=p;x=f;p=0;f=0}}i.viewPort.setCurrent(o,h);!this.node||this.parent&&"foreignObject"!==(null===(e=this.node.parentNode)||void 0===e?void 0:e.nodeName)||!this.getStyle("transform",false,true).hasValue()||this.getStyle("transform-origin",false,true).hasValue()||this.getStyle("transform-origin",true,true).setValue("50% 50%");super.setContext(t);t.translate(this.getAttribute("x").getPixels("x"),this.getAttribute("y").getPixels("y"));if(d){o=d[2];h=d[3]}r.setViewBox({ctx:t,aspectRatio:this.getAttribute("preserveAspectRatio").getString(),width:i.viewPort.width,desiredWidth:o,height:i.viewPort.height,desiredHeight:h,minX:p,minY:f,refX:l.getValue(),refY:u.getValue(),clip:v,clipX:y,clipY:x});if(d){i.viewPort.removeCurrent();i.viewPort.setCurrent(o,h)}}clearContext(t){super.clearContext(t);this.document.screen.viewPort.removeCurrent()}
/**
   * Resize SVG to fit in given size.
   * @param width
   * @param height
   * @param preserveAspectRatio
   */resize(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:t;var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];var i=this.getAttribute("width",true);var a=this.getAttribute("height",true);var s=this.getAttribute("viewBox");var n=this.getAttribute("style");var o=i.getNumber(0);var h=a.getNumber(0);if(r)if("string"===typeof r)this.getAttribute("preserveAspectRatio",true).setValue(r);else{var l=this.getAttribute("preserveAspectRatio");l.hasValue()&&l.setValue(l.getString().replace(/^\s*(\S.*\S)\s*$/,"$1"))}i.setValue(t);a.setValue(e);s.hasValue()||s.setValue("0 0 ".concat(o||t," ").concat(h||e));if(n.hasValue()){var u=this.getStyle("width");var g=this.getStyle("height");u.hasValue()&&u.setValue("".concat(t,"px"));g.hasValue()&&g.setValue("".concat(e,"px"))}}}class RectElement extends PathElement{constructor(){super(...arguments);this.type="rect"}path(t){var e=this.getAttribute("x").getPixels("x");var r=this.getAttribute("y").getPixels("y");var i=this.getStyle("width",false,true).getPixels("x");var a=this.getStyle("height",false,true).getPixels("y");var s=this.getAttribute("rx");var n=this.getAttribute("ry");var o=s.getPixels("x");var h=n.getPixels("y");s.hasValue()&&!n.hasValue()&&(h=o);n.hasValue()&&!s.hasValue()&&(o=h);o=Math.min(o,i/2);h=Math.min(h,a/2);if(t){var l=(Math.sqrt(2)-1)/3*4;t.beginPath();if(a>0&&i>0){t.moveTo(e+o,r);t.lineTo(e+i-o,r);t.bezierCurveTo(e+i-o+l*o,r,e+i,r+h-l*h,e+i,r+h);t.lineTo(e+i,r+a-h);t.bezierCurveTo(e+i,r+a-h+l*h,e+i-o+l*o,r+a,e+i-o,r+a);t.lineTo(e+o,r+a);t.bezierCurveTo(e+o-l*o,r+a,e,r+a-h+l*h,e,r+a-h);t.lineTo(e,r+h);t.bezierCurveTo(e,r+h-l*h,e+o-l*o,r,e+o,r);t.closePath()}}return new BoundingBox(e,r,e+i,r+a)}getMarkers(){return null}}class CircleElement extends PathElement{constructor(){super(...arguments);this.type="circle"}path(t){var e=this.getAttribute("cx").getPixels("x");var r=this.getAttribute("cy").getPixels("y");var i=this.getAttribute("r").getPixels();if(t&&i>0){t.beginPath();t.arc(e,r,i,0,2*Math.PI,false);t.closePath()}return new BoundingBox(e-i,r-i,e+i,r+i)}getMarkers(){return null}}class EllipseElement extends PathElement{constructor(){super(...arguments);this.type="ellipse"}path(t){var e=(Math.sqrt(2)-1)/3*4;var r=this.getAttribute("rx").getPixels("x");var i=this.getAttribute("ry").getPixels("y");var a=this.getAttribute("cx").getPixels("x");var s=this.getAttribute("cy").getPixels("y");if(t&&r>0&&i>0){t.beginPath();t.moveTo(a+r,s);t.bezierCurveTo(a+r,s+e*i,a+e*r,s+i,a,s+i);t.bezierCurveTo(a-e*r,s+i,a-r,s+e*i,a-r,s);t.bezierCurveTo(a-r,s-e*i,a-e*r,s-i,a,s-i);t.bezierCurveTo(a+e*r,s-i,a+r,s-e*i,a+r,s);t.closePath()}return new BoundingBox(a-r,s-i,a+r,s+i)}getMarkers(){return null}}class LineElement extends PathElement{constructor(){super(...arguments);this.type="line"}getPoints(){return[new Point(this.getAttribute("x1").getPixels("x"),this.getAttribute("y1").getPixels("y")),new Point(this.getAttribute("x2").getPixels("x"),this.getAttribute("y2").getPixels("y"))]}path(t){var[{x:e,y:r},{x:i,y:a}]=this.getPoints();if(t){t.beginPath();t.moveTo(e,r);t.lineTo(i,a)}return new BoundingBox(e,r,i,a)}getMarkers(){var[t,e]=this.getPoints();var r=t.angleTo(e);return[[t,r],[e,r]]}}class PolylineElement extends PathElement{constructor(t,e,r){super(t,e,r);this.type="polyline";this.points=[];this.points=Point.parsePath(this.getAttribute("points").getString())}path(t){var{points:e}=this;var[{x:r,y:i}]=e;var a=new BoundingBox(r,i);if(t){t.beginPath();t.moveTo(r,i)}e.forEach((e=>{var{x:r,y:i}=e;a.addPoint(r,i);t&&t.lineTo(r,i)}));return a}getMarkers(){var{points:t}=this;var e=t.length-1;var r=[];t.forEach(((i,a)=>{a!==e&&r.push([i,i.angleTo(t[a+1])])}));r.length>0&&r.push([t[t.length-1],r[r.length-1][1]]);return r}}class PolygonElement extends PolylineElement{constructor(){super(...arguments);this.type="polygon"}path(t){var e=super.path(t);var[{x:r,y:i}]=this.points;if(t){t.lineTo(r,i);t.closePath()}return e}}class PatternElement extends Element{constructor(){super(...arguments);this.type="pattern"}createPattern(t,e,r){var i=this.getStyle("width").getPixels("x",true);var a=this.getStyle("height").getPixels("y",true);var s=new SVGElement(this.document,null);s.attributes.viewBox=new Property(this.document,"viewBox",this.getAttribute("viewBox").getValue());s.attributes.width=new Property(this.document,"width","".concat(i,"px"));s.attributes.height=new Property(this.document,"height","".concat(a,"px"));s.attributes.transform=new Property(this.document,"transform",this.getAttribute("patternTransform").getValue());s.children=this.children;var n=this.document.createCanvas(i,a);var o=n.getContext("2d");var h=this.getAttribute("x");var l=this.getAttribute("y");h.hasValue()&&l.hasValue()&&o.translate(h.getPixels("x",true),l.getPixels("y",true));r.hasValue()?this.styles["fill-opacity"]=r:Reflect.deleteProperty(this.styles,"fill-opacity");for(var u=-1;u<=1;u++)for(var g=-1;g<=1;g++){o.save();s.attributes.x=new Property(this.document,"x",u*n.width);s.attributes.y=new Property(this.document,"y",g*n.height);s.render(o);o.restore()}var d=t.createPattern(n,"repeat");return d}}class MarkerElement extends Element{constructor(){super(...arguments);this.type="marker"}render(t,e,r){if(e){var{x:i,y:a}=e;var s=this.getAttribute("orient").getString("auto");var n=this.getAttribute("markerUnits").getString("strokeWidth");t.translate(i,a);"auto"===s&&t.rotate(r);"strokeWidth"===n&&t.scale(t.lineWidth,t.lineWidth);t.save();var o=new SVGElement(this.document,null);o.type=this.type;o.attributes.viewBox=new Property(this.document,"viewBox",this.getAttribute("viewBox").getValue());o.attributes.refX=new Property(this.document,"refX",this.getAttribute("refX").getValue());o.attributes.refY=new Property(this.document,"refY",this.getAttribute("refY").getValue());o.attributes.width=new Property(this.document,"width",this.getAttribute("markerWidth").getValue());o.attributes.height=new Property(this.document,"height",this.getAttribute("markerHeight").getValue());o.attributes.overflow=new Property(this.document,"overflow",this.getAttribute("overflow").getValue());o.attributes.fill=new Property(this.document,"fill",this.getAttribute("fill").getColor("black"));o.attributes.stroke=new Property(this.document,"stroke",this.getAttribute("stroke").getValue("none"));o.children=this.children;o.render(t);t.restore();"strokeWidth"===n&&t.scale(1/t.lineWidth,1/t.lineWidth);"auto"===s&&t.rotate(-r);t.translate(-i,-a)}}}class DefsElement extends Element{constructor(){super(...arguments);this.type="defs"}render(){}}class GElement extends RenderedElement{constructor(){super(...arguments);this.type="g"}getBoundingBox(t){var e=new BoundingBox;this.children.forEach((r=>{e.addBoundingBox(r.getBoundingBox(t))}));return e}}class GradientElement extends Element{constructor(t,e,r){super(t,e,r);this.attributesToInherit=["gradientUnits"];this.stops=[];var{stops:i,children:a}=this;a.forEach((t=>{"stop"===t.type&&i.push(t)}))}getGradientUnits(){return this.getAttribute("gradientUnits").getString("objectBoundingBox")}createGradient(t,e,r){var i=this;if(this.getHrefAttribute().hasValue()){i=this.getHrefAttribute().getDefinition();this.inheritStopContainer(i)}var{stops:a}=i;var s=this.getGradient(t,e);if(!s)return this.addParentOpacity(r,a[a.length-1].color);a.forEach((t=>{s.addColorStop(t.offset,this.addParentOpacity(r,t.color))}));if(this.getAttribute("gradientTransform").hasValue()){var{document:n}=this;var{MAX_VIRTUAL_PIXELS:o,viewPort:h}=n.screen;var[l]=h.viewPorts;var u=new RectElement(n,null);u.attributes.x=new Property(n,"x",-o/3);u.attributes.y=new Property(n,"y",-o/3);u.attributes.width=new Property(n,"width",o);u.attributes.height=new Property(n,"height",o);var g=new GElement(n,null);g.attributes.transform=new Property(n,"transform",this.getAttribute("gradientTransform").getValue());g.children=[u];var d=new SVGElement(n,null);d.attributes.x=new Property(n,"x",0);d.attributes.y=new Property(n,"y",0);d.attributes.width=new Property(n,"width",l.width);d.attributes.height=new Property(n,"height",l.height);d.children=[g];var v=n.createCanvas(l.width,l.height);var p=v.getContext("2d");p.fillStyle=s;d.render(p);return p.createPattern(v,"no-repeat")}return s}inheritStopContainer(t){this.attributesToInherit.forEach((e=>{!this.getAttribute(e).hasValue()&&t.getAttribute(e).hasValue()&&this.getAttribute(e,true).setValue(t.getAttribute(e).getValue())}))}addParentOpacity(t,e){if(t.hasValue()){var r=new Property(this.document,"color",e);return r.addOpacity(t).getColor()}return e}}class LinearGradientElement extends GradientElement{constructor(t,e,r){super(t,e,r);this.type="linearGradient";this.attributesToInherit.push("x1","y1","x2","y2")}getGradient(t,e){var r="objectBoundingBox"===this.getGradientUnits();var i=r?e.getBoundingBox(t):null;if(r&&!i)return null;if(!this.getAttribute("x1").hasValue()&&!this.getAttribute("y1").hasValue()&&!this.getAttribute("x2").hasValue()&&!this.getAttribute("y2").hasValue()){this.getAttribute("x1",true).setValue(0);this.getAttribute("y1",true).setValue(0);this.getAttribute("x2",true).setValue(1);this.getAttribute("y2",true).setValue(0)}var a=r?i.x+i.width*this.getAttribute("x1").getNumber():this.getAttribute("x1").getPixels("x");var s=r?i.y+i.height*this.getAttribute("y1").getNumber():this.getAttribute("y1").getPixels("y");var n=r?i.x+i.width*this.getAttribute("x2").getNumber():this.getAttribute("x2").getPixels("x");var o=r?i.y+i.height*this.getAttribute("y2").getNumber():this.getAttribute("y2").getPixels("y");return a===n&&s===o?null:t.createLinearGradient(a,s,n,o)}}class RadialGradientElement extends GradientElement{constructor(t,e,r){super(t,e,r);this.type="radialGradient";this.attributesToInherit.push("cx","cy","r","fx","fy","fr")}getGradient(t,e){var r="objectBoundingBox"===this.getGradientUnits();var i=e.getBoundingBox(t);if(r&&!i)return null;this.getAttribute("cx").hasValue()||this.getAttribute("cx",true).setValue("50%");this.getAttribute("cy").hasValue()||this.getAttribute("cy",true).setValue("50%");this.getAttribute("r").hasValue()||this.getAttribute("r",true).setValue("50%");var a=r?i.x+i.width*this.getAttribute("cx").getNumber():this.getAttribute("cx").getPixels("x");var s=r?i.y+i.height*this.getAttribute("cy").getNumber():this.getAttribute("cy").getPixels("y");var n=a;var o=s;this.getAttribute("fx").hasValue()&&(n=r?i.x+i.width*this.getAttribute("fx").getNumber():this.getAttribute("fx").getPixels("x"));this.getAttribute("fy").hasValue()&&(o=r?i.y+i.height*this.getAttribute("fy").getNumber():this.getAttribute("fy").getPixels("y"));var h=r?(i.width+i.height)/2*this.getAttribute("r").getNumber():this.getAttribute("r").getPixels();var l=this.getAttribute("fr").getPixels();return t.createRadialGradient(n,o,l,a,s,h)}}class StopElement extends Element{constructor(t,e,r){super(t,e,r);this.type="stop";var i=Math.max(0,Math.min(1,this.getAttribute("offset").getNumber()));var a=this.getStyle("stop-opacity");var s=this.getStyle("stop-color",true);""===s.getString()&&s.setValue("#000");a.hasValue()&&(s=s.addOpacity(a));this.offset=i;this.color=s.getColor()}}class AnimateElement extends Element{constructor(t,e,r){super(t,e,r);this.type="animate";this.duration=0;this.initialValue=null;this.initialUnits="";this.removed=false;this.frozen=false;t.screen.animations.push(this);this.begin=this.getAttribute("begin").getMilliseconds();this.maxDuration=this.begin+this.getAttribute("dur").getMilliseconds();this.from=this.getAttribute("from");this.to=this.getAttribute("to");this.values=new Property(t,"values",null);var i=this.getAttribute("values");i.hasValue()&&this.values.setValue(i.getString().split(";"))}getProperty(){var t=this.getAttribute("attributeType").getString();var e=this.getAttribute("attributeName").getString();return"CSS"===t?this.parent.getStyle(e,true):this.parent.getAttribute(e,true)}calcValue(){var{initialUnits:t}=this;var{progress:e,from:r,to:i}=this.getProgress();var a=r.getNumber()+(i.getNumber()-r.getNumber())*e;"%"===t&&(a*=100);return"".concat(a).concat(t)}update(t){var{parent:e}=this;var r=this.getProperty();if(!this.initialValue){this.initialValue=r.getString();this.initialUnits=r.getUnits()}if(this.duration>this.maxDuration){var i=this.getAttribute("fill").getString("remove");if("indefinite"===this.getAttribute("repeatCount").getString()||"indefinite"===this.getAttribute("repeatDur").getString())this.duration=0;else if("freeze"!==i||this.frozen){if("remove"===i&&!this.removed){this.removed=true;r.setValue(e.animationFrozen?e.animationFrozenValue:this.initialValue);return true}}else{this.frozen=true;e.animationFrozen=true;e.animationFrozenValue=r.getString()}return false}this.duration+=t;var a=false;if(this.begin<this.duration){var s=this.calcValue();var n=this.getAttribute("type");if(n.hasValue()){var o=n.getString();s="".concat(o,"(").concat(s,")")}r.setValue(s);a=true}return a}getProgress(){var{document:t,values:e}=this;var r={progress:(this.duration-this.begin)/(this.maxDuration-this.begin)};if(e.hasValue()){var i=r.progress*(e.getValue().length-1);var a=Math.floor(i);var s=Math.ceil(i);r.from=new Property(t,"from",parseFloat(e.getValue()[a]));r.to=new Property(t,"to",parseFloat(e.getValue()[s]));r.progress=(i-a)/(s-a)}else{r.from=this.from;r.to=this.to}return r}}class AnimateColorElement extends AnimateElement{constructor(){super(...arguments);this.type="animateColor"}calcValue(){var{progress:t,from:e,to:r}=this.getProgress();var a=new i(e.getColor());var s=new i(r.getColor());if(a.ok&&s.ok){var n=a.r+(s.r-a.r)*t;var o=a.g+(s.g-a.g)*t;var h=a.b+(s.b-a.b)*t;return"rgb(".concat(Math.floor(n),", ").concat(Math.floor(o),", ").concat(Math.floor(h),")")}return this.getAttribute("from").getColor()}}class AnimateTransformElement extends AnimateElement{constructor(){super(...arguments);this.type="animateTransform"}calcValue(){var{progress:t,from:e,to:r}=this.getProgress();var i=toNumbers(e.getString());var a=toNumbers(r.getString());var s=i.map(((e,r)=>{var i=a[r];return e+(i-e)*t})).join(" ");return s}}class FontElement extends Element{constructor(t,e,r){super(t,e,r);this.type="font";this.glyphs={};this.horizAdvX=this.getAttribute("horiz-adv-x").getNumber();var{definitions:i}=t;var{children:a}=this;for(var s of a)switch(s.type){case"font-face":this.fontFace=s;var n=s.getStyle("font-family");n.hasValue()&&(i[n.getString()]=this);break;case"missing-glyph":this.missingGlyph=s;break;case"glyph":var o=s;if(o.arabicForm){this.isRTL=true;this.isArabic=true;"undefined"===typeof this.glyphs[o.unicode]&&(this.glyphs[o.unicode]={});this.glyphs[o.unicode][o.arabicForm]=o}else this.glyphs[o.unicode]=o;break}}render(){}}class FontFaceElement extends Element{constructor(t,e,r){super(t,e,r);this.type="font-face";this.ascent=this.getAttribute("ascent").getNumber();this.descent=this.getAttribute("descent").getNumber();this.unitsPerEm=this.getAttribute("units-per-em").getNumber()}}class MissingGlyphElement extends PathElement{constructor(){super(...arguments);this.type="missing-glyph";this.horizAdvX=0}}class TRefElement extends TextElement{constructor(){super(...arguments);this.type="tref"}getText(){var t=this.getHrefAttribute().getDefinition();if(t){var e=t.children[0];if(e)return e.getText()}return""}}class AElement extends TextElement{constructor(t,e,r){super(t,e,r);this.type="a";var{childNodes:i}=e;var a=i[0];var s=i.length>0&&Array.from(i).every((t=>3===t.nodeType));this.hasText=s;this.text=s?this.getTextFromNode(a):""}getText(){return this.text}renderChildren(t){if(this.hasText){super.renderChildren(t);var{document:e,x:r,y:i}=this;var{mouse:a}=e.screen;var s=new Property(e,"fontSize",Font.parse(e.ctx.font).fontSize);a.isWorking()&&a.checkBoundingBox(this,new BoundingBox(r,i-s.getPixels("y"),r+this.measureText(t),i))}else if(this.children.length>0){var n=new GElement(this.document,null);n.children=this.children;n.parent=this;n.render(t)}}onClick(){var{window:t}=this.document;t&&t.open(this.getHrefAttribute().getString())}onMouseMove(){var t=this.document.ctx;t.canvas.style.cursor="pointer"}}function ownKeys$2(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})));r.push.apply(r,i)}return r}function _objectSpread$2(t){for(var r=1;r<arguments.length;r++){var i=null!=arguments[r]?arguments[r]:{};r%2?ownKeys$2(Object(i),true).forEach((function(r){e(t,r,i[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):ownKeys$2(Object(i)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))}))}return t}class TextPathElement extends TextElement{constructor(t,e,r){super(t,e,r);this.type="textPath";this.textWidth=0;this.textHeight=0;this.pathLength=-1;this.glyphInfo=null;this.letterSpacingCache=[];this.measuresCache=new Map([["",0]]);var i=this.getHrefAttribute().getDefinition();this.text=this.getTextFromNode();this.dataArray=this.parsePathData(i)}getText(){return this.text}path(t){var{dataArray:e}=this;t&&t.beginPath();e.forEach((e=>{var{type:r,points:i}=e;switch(r){case PathParser.LINE_TO:t&&t.lineTo(i[0],i[1]);break;case PathParser.MOVE_TO:t&&t.moveTo(i[0],i[1]);break;case PathParser.CURVE_TO:t&&t.bezierCurveTo(i[0],i[1],i[2],i[3],i[4],i[5]);break;case PathParser.QUAD_TO:t&&t.quadraticCurveTo(i[0],i[1],i[2],i[3]);break;case PathParser.ARC:var[a,s,n,o,h,l,u,g]=i;var d=n>o?n:o;var v=n>o?1:n/o;var p=n>o?o/n:1;if(t){t.translate(a,s);t.rotate(u);t.scale(v,p);t.arc(0,0,d,h,h+l,Boolean(1-g));t.scale(1/v,1/p);t.rotate(-u);t.translate(-a,-s)}break;case PathParser.CLOSE_PATH:t&&t.closePath();break}}))}renderChildren(t){this.setTextData(t);t.save();var e=this.parent.getStyle("text-decoration").getString();var r=this.getFontSize();var{glyphInfo:i}=this;var a=t.fillStyle;"underline"===e&&t.beginPath();i.forEach(((i,a)=>{var{p0:s,p1:n,rotation:o,text:h}=i;t.save();t.translate(s.x,s.y);t.rotate(o);t.fillStyle&&t.fillText(h,0,0);t.strokeStyle&&t.strokeText(h,0,0);t.restore();if("underline"===e){0===a&&t.moveTo(s.x,s.y+r/8);t.lineTo(n.x,n.y+r/5)}}));if("underline"===e){t.lineWidth=r/20;t.strokeStyle=a;t.stroke();t.closePath()}t.restore()}getLetterSpacingAt(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this.letterSpacingCache[t]||0}findSegmentToFitChar(t,e,r,i,a,s,n,o,h){var l=s;var u=this.measureText(t,o);" "===o&&"justify"===e&&r<i&&(u+=(i-r)/a);h>-1&&(l+=this.getLetterSpacingAt(h));var g=this.textHeight/20;var d=this.getEquidistantPointOnPath(l,g,0);var v=this.getEquidistantPointOnPath(l+u,g,0);var p={p0:d,p1:v};var f=d&&v?Math.atan2(v.y-d.y,v.x-d.x):0;if(n){var y=Math.cos(Math.PI/2+f)*n;var x=Math.cos(-f)*n;p.p0=_objectSpread$2(_objectSpread$2({},d),{},{x:d.x+y,y:d.y+x});p.p1=_objectSpread$2(_objectSpread$2({},v),{},{x:v.x+y,y:v.y+x})}l+=u;return{offset:l,segment:p,rotation:f}}measureText(t,e){var{measuresCache:r}=this;var i=e||this.getText();if(r.has(i))return r.get(i);var a=this.measureTargetText(t,i);r.set(i,a);return a}setTextData(t){if(!this.glyphInfo){var e=this.getText();var r=e.split("");var i=e.split(" ").length-1;var a=this.parent.getAttribute("dx").split().map((t=>t.getPixels("x")));var s=this.parent.getAttribute("dy").getPixels("y");var n=this.parent.getStyle("text-anchor").getString("start");var o=this.getStyle("letter-spacing");var h=this.parent.getStyle("letter-spacing");var l=0;o.hasValue()&&"inherit"!==o.getValue()?o.hasValue()&&"initial"!==o.getValue()&&"unset"!==o.getValue()&&(l=o.getPixels()):l=h.getPixels();var u=[];var g=e.length;this.letterSpacingCache=u;for(var d=0;d<g;d++)u.push("undefined"!==typeof a[d]?a[d]:l);var v=u.reduce(((t,e,r)=>0===r?0:t+e||0),0);var p=this.measureText(t);var f=Math.max(p+v,0);this.textWidth=p;this.textHeight=this.getFontSize();this.glyphInfo=[];var y=this.getPathLength();var x=this.getStyle("startOffset").getNumber(0)*y;var P=0;"middle"!==n&&"center"!==n||(P=-f/2);"end"!==n&&"right"!==n||(P=-f);P+=x;r.forEach(((e,a)=>{var{offset:o,segment:h,rotation:l}=this.findSegmentToFitChar(t,n,f,y,i,P,s,e,a);P=o;h.p0&&h.p1&&this.glyphInfo.push({text:r[a],p0:h.p0,p1:h.p1,rotation:l})}))}}parsePathData(t){this.pathLength=-1;if(!t)return[];var e=[];var{pathParser:r}=t;r.reset();while(!r.isEnd()){var{current:i}=r;var a=i?i.x:0;var s=i?i.y:0;var n=r.next();var o=n.type;var h=[];switch(n.type){case PathParser.MOVE_TO:this.pathM(r,h);break;case PathParser.LINE_TO:o=this.pathL(r,h);break;case PathParser.HORIZ_LINE_TO:o=this.pathH(r,h);break;case PathParser.VERT_LINE_TO:o=this.pathV(r,h);break;case PathParser.CURVE_TO:this.pathC(r,h);break;case PathParser.SMOOTH_CURVE_TO:o=this.pathS(r,h);break;case PathParser.QUAD_TO:this.pathQ(r,h);break;case PathParser.SMOOTH_QUAD_TO:o=this.pathT(r,h);break;case PathParser.ARC:h=this.pathA(r);break;case PathParser.CLOSE_PATH:PathElement.pathZ(r);break}n.type!==PathParser.CLOSE_PATH?e.push({type:o,points:h,start:{x:a,y:s},pathLength:this.calcLength(a,s,o,h)}):e.push({type:PathParser.CLOSE_PATH,points:[],pathLength:0})}return e}pathM(t,e){var{x:r,y:i}=PathElement.pathM(t).point;e.push(r,i)}pathL(t,e){var{x:r,y:i}=PathElement.pathL(t).point;e.push(r,i);return PathParser.LINE_TO}pathH(t,e){var{x:r,y:i}=PathElement.pathH(t).point;e.push(r,i);return PathParser.LINE_TO}pathV(t,e){var{x:r,y:i}=PathElement.pathV(t).point;e.push(r,i);return PathParser.LINE_TO}pathC(t,e){var{point:r,controlPoint:i,currentPoint:a}=PathElement.pathC(t);e.push(r.x,r.y,i.x,i.y,a.x,a.y)}pathS(t,e){var{point:r,controlPoint:i,currentPoint:a}=PathElement.pathS(t);e.push(r.x,r.y,i.x,i.y,a.x,a.y);return PathParser.CURVE_TO}pathQ(t,e){var{controlPoint:r,currentPoint:i}=PathElement.pathQ(t);e.push(r.x,r.y,i.x,i.y)}pathT(t,e){var{controlPoint:r,currentPoint:i}=PathElement.pathT(t);e.push(r.x,r.y,i.x,i.y);return PathParser.QUAD_TO}pathA(t){var{rX:e,rY:r,sweepFlag:i,xAxisRotation:a,centp:s,a1:n,ad:o}=PathElement.pathA(t);0===i&&o>0&&(o-=2*Math.PI);1===i&&o<0&&(o+=2*Math.PI);return[s.x,s.y,e,r,n,o,a,i]}calcLength(t,e,r,i){var a=0;var s=null;var n=null;var o=0;switch(r){case PathParser.LINE_TO:return this.getLineLength(t,e,i[0],i[1]);case PathParser.CURVE_TO:a=0;s=this.getPointOnCubicBezier(0,t,e,i[0],i[1],i[2],i[3],i[4],i[5]);for(o=.01;o<=1;o+=.01){n=this.getPointOnCubicBezier(o,t,e,i[0],i[1],i[2],i[3],i[4],i[5]);a+=this.getLineLength(s.x,s.y,n.x,n.y);s=n}return a;case PathParser.QUAD_TO:a=0;s=this.getPointOnQuadraticBezier(0,t,e,i[0],i[1],i[2],i[3]);for(o=.01;o<=1;o+=.01){n=this.getPointOnQuadraticBezier(o,t,e,i[0],i[1],i[2],i[3]);a+=this.getLineLength(s.x,s.y,n.x,n.y);s=n}return a;case PathParser.ARC:a=0;var h=i[4];var l=i[5];var u=i[4]+l;var g=Math.PI/180;Math.abs(h-u)<g&&(g=Math.abs(h-u));s=this.getPointOnEllipticalArc(i[0],i[1],i[2],i[3],h,0);if(l<0)for(o=h-g;o>u;o-=g){n=this.getPointOnEllipticalArc(i[0],i[1],i[2],i[3],o,0);a+=this.getLineLength(s.x,s.y,n.x,n.y);s=n}else for(o=h+g;o<u;o+=g){n=this.getPointOnEllipticalArc(i[0],i[1],i[2],i[3],o,0);a+=this.getLineLength(s.x,s.y,n.x,n.y);s=n}n=this.getPointOnEllipticalArc(i[0],i[1],i[2],i[3],u,0);a+=this.getLineLength(s.x,s.y,n.x,n.y);return a}return 0}getPointOnLine(t,e,r,i,a){var s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:e;var n=arguments.length>6&&void 0!==arguments[6]?arguments[6]:r;var o=(a-r)/(i-e+f);var h=Math.sqrt(t*t/(1+o*o));i<e&&(h*=-1);var l=o*h;var u=null;if(i===e)u={x:s,y:n+l};else if((n-r)/(s-e+f)===o)u={x:s+h,y:n+l};else{var g=0;var d=0;var v=this.getLineLength(e,r,i,a);if(v<f)return null;var p=(s-e)*(i-e)+(n-r)*(a-r);p/=v*v;g=e+p*(i-e);d=r+p*(a-r);var y=this.getLineLength(s,n,g,d);var x=Math.sqrt(t*t-y*y);h=Math.sqrt(x*x/(1+o*o));i<e&&(h*=-1);l=o*h;u={x:g+h,y:d+l}}return u}getPointOnPath(t){var e=this.getPathLength();var r=0;var i=null;if(t<-5e-5||t-5e-5>e)return null;var{dataArray:a}=this;for(var s of a){if(!s||!(s.pathLength<5e-5||r+s.pathLength+5e-5<t)){var n=t-r;var o=0;switch(s.type){case PathParser.LINE_TO:i=this.getPointOnLine(n,s.start.x,s.start.y,s.points[0],s.points[1],s.start.x,s.start.y);break;case PathParser.ARC:var h=s.points[4];var l=s.points[5];var u=s.points[4]+l;o=h+n/s.pathLength*l;if(l<0&&o<u||l>=0&&o>u)break;i=this.getPointOnEllipticalArc(s.points[0],s.points[1],s.points[2],s.points[3],o,s.points[6]);break;case PathParser.CURVE_TO:o=n/s.pathLength;o>1&&(o=1);i=this.getPointOnCubicBezier(o,s.start.x,s.start.y,s.points[0],s.points[1],s.points[2],s.points[3],s.points[4],s.points[5]);break;case PathParser.QUAD_TO:o=n/s.pathLength;o>1&&(o=1);i=this.getPointOnQuadraticBezier(o,s.start.x,s.start.y,s.points[0],s.points[1],s.points[2],s.points[3]);break}if(i)return i;break}r+=s.pathLength}return null}getLineLength(t,e,r,i){return Math.sqrt((r-t)*(r-t)+(i-e)*(i-e))}getPathLength(){-1===this.pathLength&&(this.pathLength=this.dataArray.reduce(((t,e)=>e.pathLength>0?t+e.pathLength:t),0));return this.pathLength}getPointOnCubicBezier(t,e,r,i,a,s,n,o,h){var l=o*CB1(t)+s*CB2(t)+i*CB3(t)+e*CB4(t);var u=h*CB1(t)+n*CB2(t)+a*CB3(t)+r*CB4(t);return{x:l,y:u}}getPointOnQuadraticBezier(t,e,r,i,a,s,n){var o=s*QB1(t)+i*QB2(t)+e*QB3(t);var h=n*QB1(t)+a*QB2(t)+r*QB3(t);return{x:o,y:h}}getPointOnEllipticalArc(t,e,r,i,a,s){var n=Math.cos(s);var o=Math.sin(s);var h={x:r*Math.cos(a),y:i*Math.sin(a)};return{x:t+(h.x*n-h.y*o),y:e+(h.x*o+h.y*n)}}buildEquidistantCache(t,e){var r=this.getPathLength();var i=e||.25;var a=t||r/100;if(!this.equidistantCache||this.equidistantCache.step!==a||this.equidistantCache.precision!==i){this.equidistantCache={step:a,precision:i,points:[]};var s=0;for(var n=0;n<=r;n+=i){var o=this.getPointOnPath(n);var h=this.getPointOnPath(n+i);if(o&&h){s+=this.getLineLength(o.x,o.y,h.x,h.y);if(s>=a){this.equidistantCache.points.push({x:o.x,y:o.y,distance:n});s-=a}}}}}getEquidistantPointOnPath(t,e,r){this.buildEquidistantCache(e,r);if(t<0||t-this.getPathLength()>5e-5)return null;var i=Math.round(t/this.getPathLength()*(this.equidistantCache.points.length-1));return this.equidistantCache.points[i]||null}}var S=/^\s*data:(([^/,;]+\/[^/,;]+)(?:;([^,;=]+=[^,;=]+))?)?(?:;(base64))?,(.*)$/i;class ImageElement extends RenderedElement{constructor(t,e,r){super(t,e,r);this.type="image";this.loaded=false;var i=this.getHrefAttribute().getString();if(i){var a=i.endsWith(".svg")||/^\s*data:image\/svg\+xml/i.test(i);t.images.push(this);a?void this.loadSvg(i):void this.loadImage(i);this.isSvg=a}}loadImage(e){var r=this;return t((function*(){try{var t=yield r.document.createImage(e);r.image=t}catch(t){console.error('Error while loading image "'.concat(e,'":'),t)}r.loaded=true}))()}loadSvg(e){var r=this;return t((function*(){var t=S.exec(e);if(t){var i=t[5];"base64"===t[4]?r.image=atob(i):r.image=decodeURIComponent(i)}else try{var a=yield r.document.fetch(e);var s=yield a.text();r.image=s}catch(t){console.error('Error while loading image "'.concat(e,'":'),t)}r.loaded=true}))()}renderChildren(t){var{document:e,image:r,loaded:i}=this;var a=this.getAttribute("x").getPixels("x");var s=this.getAttribute("y").getPixels("y");var n=this.getStyle("width").getPixels("x");var o=this.getStyle("height").getPixels("y");if(i&&r&&n&&o){t.save();t.translate(a,s);if(this.isSvg){var h=e.canvg.forkString(t,this.image,{ignoreMouse:true,ignoreAnimation:true,ignoreDimensions:true,ignoreClear:true,offsetX:0,offsetY:0,scaleWidth:n,scaleHeight:o});h.document.documentElement.parent=this;void h.render()}else{var l=this.image;e.setViewBox({ctx:t,aspectRatio:this.getAttribute("preserveAspectRatio").getString(),width:n,desiredWidth:l.width,height:o,desiredHeight:l.height});this.loaded&&("undefined"===typeof l.complete||l.complete)&&t.drawImage(l,0,0)}t.restore()}}getBoundingBox(){var t=this.getAttribute("x").getPixels("x");var e=this.getAttribute("y").getPixels("y");var r=this.getStyle("width").getPixels("x");var i=this.getStyle("height").getPixels("y");return new BoundingBox(t,e,t+r,e+i)}}class SymbolElement extends RenderedElement{constructor(){super(...arguments);this.type="symbol"}render(t){}}class SVGFontLoader{constructor(t){this.document=t;this.loaded=false;t.fonts.push(this)}load(e,r){var i=this;return t((function*(){try{var{document:t}=i;var a=yield t.canvg.parser.load(r);var s=a.getElementsByTagName("font");Array.from(s).forEach((r=>{var i=t.createElement(r);t.definitions[e]=i}))}catch(t){console.error('Error while loading font "'.concat(r,'":'),t)}i.loaded=true}))()}}class StyleElement extends Element{constructor(t,e,r){super(t,e,r);this.type="style";var i=compressSpaces(Array.from(e.childNodes).map((t=>t.textContent)).join("").replace(/(\/\*([^*]|[\r\n]|(\*+([^*/]|[\r\n])))*\*+\/)|(^[\s]*\/\/.*)/gm,"").replace(/@import.*;/g,""));var a=i.split("}");a.forEach((e=>{var r=e.trim();if(r){var i=r.split("{");var a=i[0].split(",");var s=i[1].split(";");a.forEach((e=>{var r=e.trim();if(r){var i=t.styles[r]||{};s.forEach((e=>{var r=e.indexOf(":");var a=e.substr(0,r).trim();var s=e.substr(r+1,e.length-r).trim();a&&s&&(i[a]=new Property(t,a,s))}));t.styles[r]=i;t.stylesSpecificity[r]=getSelectorSpecificity(r);if("@font-face"===r){var a=i["font-family"].getString().replace(/"|'/g,"");var n=i.src.getString().split(",");n.forEach((e=>{if(e.indexOf('format("svg")')>0){var r=parseExternalUrl(e);r&&void new SVGFontLoader(t).load(a,r)}}))}}}))}}))}}StyleElement.parseExternalUrl=parseExternalUrl;class UseElement extends RenderedElement{constructor(){super(...arguments);this.type="use"}setContext(t){super.setContext(t);var e=this.getAttribute("x");var r=this.getAttribute("y");e.hasValue()&&t.translate(e.getPixels("x"),0);r.hasValue()&&t.translate(0,r.getPixels("y"))}path(t){var{element:e}=this;e&&e.path(t)}renderChildren(t){var{document:e,element:r}=this;if(r){var i=r;if("symbol"===r.type){i=new SVGElement(e,null);i.attributes.viewBox=new Property(e,"viewBox",r.getAttribute("viewBox").getString());i.attributes.preserveAspectRatio=new Property(e,"preserveAspectRatio",r.getAttribute("preserveAspectRatio").getString());i.attributes.overflow=new Property(e,"overflow",r.getAttribute("overflow").getString());i.children=r.children;r.styles.opacity=new Property(e,"opacity",this.calculateOpacity())}if("svg"===i.type){var a=this.getStyle("width",false,true);var s=this.getStyle("height",false,true);a.hasValue()&&(i.attributes.width=new Property(e,"width",a.getString()));s.hasValue()&&(i.attributes.height=new Property(e,"height",s.getString()))}var n=i.parent;i.parent=this;i.render(t);i.parent=n}}getBoundingBox(t){var{element:e}=this;return e?e.getBoundingBox(t):null}elementTransform(){var{document:t,element:e}=this;return Transform.fromElement(t,e)}get element(){this.cachedElement||(this.cachedElement=this.getHrefAttribute().getDefinition());return this.cachedElement}}function imGet(t,e,r,i,a,s){return t[r*i*4+4*e+s]}function imSet(t,e,r,i,a,s,n){t[r*i*4+4*e+s]=n}function m(t,e,r){var i=t[e];return i*r}function c(t,e,r,i){return e+Math.cos(t)*r+Math.sin(t)*i}class FeColorMatrixElement extends Element{constructor(t,e,r){super(t,e,r);this.type="feColorMatrix";var i=toNumbers(this.getAttribute("values").getString());switch(this.getAttribute("type").getString("matrix")){case"saturate":var a=i[0];i=[.213+.787*a,.715-.715*a,.072-.072*a,0,0,.213-.213*a,.715+.285*a,.072-.072*a,0,0,.213-.213*a,.715-.715*a,.072+.928*a,0,0,0,0,0,1,0,0,0,0,0,1];break;case"hueRotate":var s=i[0]*Math.PI/180;i=[c(s,.213,.787,-.213),c(s,.715,-.715,-.715),c(s,.072,-.072,.928),0,0,c(s,.213,-.213,.143),c(s,.715,.285,.14),c(s,.072,-.072,-.283),0,0,c(s,.213,-.213,-.787),c(s,.715,-.715,.715),c(s,.072,.928,.072),0,0,0,0,0,1,0,0,0,0,0,1];break;case"luminanceToAlpha":i=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,.2125,.7154,.0721,0,0,0,0,0,0,1];break}this.matrix=i;this.includeOpacity=this.getAttribute("includeOpacity").hasValue()}apply(t,e,r,i,a){var{includeOpacity:s,matrix:n}=this;var o=t.getImageData(0,0,i,a);for(var h=0;h<a;h++)for(var l=0;l<i;l++){var u=imGet(o.data,l,h,i,a,0);var g=imGet(o.data,l,h,i,a,1);var d=imGet(o.data,l,h,i,a,2);var v=imGet(o.data,l,h,i,a,3);var p=m(n,0,u)+m(n,1,g)+m(n,2,d)+m(n,3,v)+m(n,4,1);var f=m(n,5,u)+m(n,6,g)+m(n,7,d)+m(n,8,v)+m(n,9,1);var y=m(n,10,u)+m(n,11,g)+m(n,12,d)+m(n,13,v)+m(n,14,1);var x=m(n,15,u)+m(n,16,g)+m(n,17,d)+m(n,18,v)+m(n,19,1);if(s){p=0;f=0;y=0;x*=v/255}imSet(o.data,l,h,i,a,0,p);imSet(o.data,l,h,i,a,1,f);imSet(o.data,l,h,i,a,2,y);imSet(o.data,l,h,i,a,3,x)}t.clearRect(0,0,i,a);t.putImageData(o,0,0)}}class MaskElement extends Element{constructor(){super(...arguments);this.type="mask"}apply(t,e){var{document:r}=this;var i=this.getAttribute("x").getPixels("x");var a=this.getAttribute("y").getPixels("y");var s=this.getStyle("width").getPixels("x");var n=this.getStyle("height").getPixels("y");if(!s&&!n){var o=new BoundingBox;this.children.forEach((e=>{o.addBoundingBox(e.getBoundingBox(t))}));i=Math.floor(o.x1);a=Math.floor(o.y1);s=Math.floor(o.width);n=Math.floor(o.height)}var h=this.removeStyles(e,MaskElement.ignoreStyles);var l=r.createCanvas(i+s,a+n);var u=l.getContext("2d");r.screen.setDefaults(u);this.renderChildren(u);new FeColorMatrixElement(r,{nodeType:1,childNodes:[],attributes:[{nodeName:"type",value:"luminanceToAlpha"},{nodeName:"includeOpacity",value:"true"}]}).apply(u,0,0,i+s,a+n);var g=r.createCanvas(i+s,a+n);var d=g.getContext("2d");r.screen.setDefaults(d);e.render(d);d.globalCompositeOperation="destination-in";d.fillStyle=u.createPattern(l,"no-repeat");d.fillRect(0,0,i+s,a+n);t.fillStyle=d.createPattern(g,"no-repeat");t.fillRect(0,0,i+s,a+n);this.restoreStyles(e,h)}render(t){}}MaskElement.ignoreStyles=["mask","transform","clip-path"];var noop=()=>{};class ClipPathElement extends Element{constructor(){super(...arguments);this.type="clipPath"}apply(t){var{document:e}=this;var r=Reflect.getPrototypeOf(t);var{beginPath:i,closePath:a}=t;if(r){r.beginPath=noop;r.closePath=noop}Reflect.apply(i,t,[]);this.children.forEach((i=>{if("undefined"!==typeof i.path){var s="undefined"!==typeof i.elementTransform?i.elementTransform():null;s||(s=Transform.fromElement(e,i));s&&s.apply(t);i.path(t);r&&(r.closePath=a);s&&s.unapply(t)}}));Reflect.apply(a,t,[]);t.clip();if(r){r.beginPath=i;r.closePath=a}}render(t){}}class FilterElement extends Element{constructor(){super(...arguments);this.type="filter"}apply(t,e){var{document:r,children:i}=this;var a=e.getBoundingBox(t);if(a){var s=0;var n=0;i.forEach((t=>{var e=t.extraFilterDistance||0;s=Math.max(s,e);n=Math.max(n,e)}));var o=Math.floor(a.width);var h=Math.floor(a.height);var l=o+2*s;var u=h+2*n;if(!(l<1||u<1)){var g=Math.floor(a.x);var d=Math.floor(a.y);var v=this.removeStyles(e,FilterElement.ignoreStyles);var p=r.createCanvas(l,u);var f=p.getContext("2d");r.screen.setDefaults(f);f.translate(-g+s,-d+n);e.render(f);i.forEach((t=>{"function"===typeof t.apply&&t.apply(f,0,0,l,u)}));t.drawImage(p,0,0,l,u,g-s,d-n,l,u);this.restoreStyles(e,v)}}}render(t){}}FilterElement.ignoreStyles=["filter","transform","clip-path"];class FeDropShadowElement extends Element{constructor(t,e,r){super(t,e,r);this.type="feDropShadow";this.addStylesFromStyleDefinition()}apply(t,e,r,i,a){}}class FeMorphologyElement extends Element{constructor(){super(...arguments);this.type="feMorphology"}apply(t,e,r,i,a){}}class FeCompositeElement extends Element{constructor(){super(...arguments);this.type="feComposite"}apply(t,e,r,i,a){}}class FeGaussianBlurElement extends Element{constructor(t,e,r){super(t,e,r);this.type="feGaussianBlur";this.blurRadius=Math.floor(this.getAttribute("stdDeviation").getNumber());this.extraFilterDistance=this.blurRadius}apply(t,e,r,i,a){var{document:n,blurRadius:o}=this;var h=n.window?n.window.document.body:null;var l=t.canvas;l.id=n.getUniqueId();if(h){l.style.display="none";h.appendChild(l)}s(l,e,r,i,a,o);h&&h.removeChild(l)}}class TitleElement extends Element{constructor(){super(...arguments);this.type="title"}}class DescElement extends Element{constructor(){super(...arguments);this.type="desc"}}var E={svg:SVGElement,rect:RectElement,circle:CircleElement,ellipse:EllipseElement,line:LineElement,polyline:PolylineElement,polygon:PolygonElement,path:PathElement,pattern:PatternElement,marker:MarkerElement,defs:DefsElement,linearGradient:LinearGradientElement,radialGradient:RadialGradientElement,stop:StopElement,animate:AnimateElement,animateColor:AnimateColorElement,animateTransform:AnimateTransformElement,font:FontElement,"font-face":FontFaceElement,"missing-glyph":MissingGlyphElement,glyph:GlyphElement,text:TextElement,tspan:TSpanElement,tref:TRefElement,a:AElement,textPath:TextPathElement,image:ImageElement,g:GElement,symbol:SymbolElement,style:StyleElement,use:UseElement,mask:MaskElement,clipPath:ClipPathElement,filter:FilterElement,feDropShadow:FeDropShadowElement,feMorphology:FeMorphologyElement,feComposite:FeCompositeElement,feColorMatrix:FeColorMatrixElement,feGaussianBlur:FeGaussianBlurElement,title:TitleElement,desc:DescElement};function ownKeys$1(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})));r.push.apply(r,i)}return r}function _objectSpread$1(t){for(var r=1;r<arguments.length;r++){var i=null!=arguments[r]?arguments[r]:{};r%2?ownKeys$1(Object(i),true).forEach((function(r){e(t,r,i[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):ownKeys$1(Object(i)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))}))}return t}function createCanvas(t,e){var r=document.createElement("canvas");r.width=t;r.height=e;return r}function createImage(t){return _createImage.apply(this,arguments)}function _createImage(){_createImage=t((function*(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];var r=document.createElement("img");e&&(r.crossOrigin="Anonymous");return new Promise(((e,i)=>{r.onload=()=>{e(r)};r.onerror=(t,e,r,a,s)=>{i(s)};r.src=t}))}));return _createImage.apply(this,arguments)}class Document{constructor(t){var{rootEmSize:e=12,emSize:r=12,createCanvas:i=Document.createCanvas,createImage:a=Document.createImage,anonymousCrossOrigin:s}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.canvg=t;this.definitions={};this.styles={};this.stylesSpecificity={};this.images=[];this.fonts=[];this.emSizeStack=[];this.uniqueId=0;this.screen=t.screen;this.rootEmSize=e;this.emSize=r;this.createCanvas=i;this.createImage=this.bindCreateImage(a,s);this.screen.wait(this.isImagesLoaded.bind(this));this.screen.wait(this.isFontsLoaded.bind(this))}bindCreateImage(t,e){return"boolean"===typeof e?(r,i)=>t(r,"boolean"===typeof i?i:e):t}get window(){return this.screen.window}get fetch(){return this.screen.fetch}get ctx(){return this.screen.ctx}get emSize(){var{emSizeStack:t}=this;return t[t.length-1]}set emSize(t){var{emSizeStack:e}=this;e.push(t)}popEmSize(){var{emSizeStack:t}=this;t.pop()}getUniqueId(){return"canvg".concat(++this.uniqueId)}isImagesLoaded(){return this.images.every((t=>t.loaded))}isFontsLoaded(){return this.fonts.every((t=>t.loaded))}createDocumentElement(t){var e=this.createElement(t.documentElement);e.root=true;e.addStylesFromStyleDefinition();this.documentElement=e;return e}createElement(t){var e=t.nodeName.replace(/^[^:]+:/,"");var r=Document.elementTypes[e];return"undefined"!==typeof r?new r(this,t):new UnknownElement(this,t)}createTextNode(t){return new TextNode(this,t)}setViewBox(t){this.screen.setViewBox(_objectSpread$1({document:this},t))}}Document.createCanvas=createCanvas;Document.createImage=createImage;Document.elementTypes=E;function ownKeys(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})));r.push.apply(r,i)}return r}function _objectSpread(t){for(var r=1;r<arguments.length;r++){var i=null!=arguments[r]?arguments[r]:{};r%2?ownKeys(Object(i),true).forEach((function(r){e(t,r,i[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):ownKeys(Object(i)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))}))}return t}class Canvg{
/**
   * Main constructor.
   * @param ctx - Rendering context.
   * @param svg - SVG Document.
   * @param options - Rendering options.
   */
constructor(t,e){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};this.parser=new Parser(r);this.screen=new Screen(t,r);this.options=r;var i=new Document(this,r);var a=i.createDocumentElement(e);this.document=i;this.documentElement=a}
/**
   * Create Canvg instance from SVG source string or URL.
   * @param ctx - Rendering context.
   * @param svg - SVG source string or URL.
   * @param options - Rendering options.
   * @returns Canvg instance.
   */static from(e,r){var i=arguments;return t((function*(){var t=i.length>2&&void 0!==i[2]?i[2]:{};var a=new Parser(t);var s=yield a.parse(r);return new Canvg(e,s,t)}))()}
/**
   * Create Canvg instance from SVG source string.
   * @param ctx - Rendering context.
   * @param svg - SVG source string.
   * @param options - Rendering options.
   * @returns Canvg instance.
   */static fromString(t,e){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};var i=new Parser(r);var a=i.parseFromString(e);return new Canvg(t,a,r)}
/**
   * Create new Canvg instance with inherited options.
   * @param ctx - Rendering context.
   * @param svg - SVG source string or URL.
   * @param options - Rendering options.
   * @returns Canvg instance.
   */fork(t,e){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return Canvg.from(t,e,_objectSpread(_objectSpread({},this.options),r))}
/**
   * Create new Canvg instance with inherited options.
   * @param ctx - Rendering context.
   * @param svg - SVG source string.
   * @param options - Rendering options.
   * @returns Canvg instance.
   */forkString(t,e){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return Canvg.fromString(t,e,_objectSpread(_objectSpread({},this.options),r))}
/**
   * Document is ready promise.
   * @returns Ready promise.
   */ready(){return this.screen.ready()}
/**
   * Document is ready value.
   * @returns Is ready or not.
   */isReady(){return this.screen.isReady()}
/**
   * Render only first frame, ignoring animations and mouse.
   * @param options - Rendering options.
   */render(){var e=arguments,r=this;return t((function*(){var t=e.length>0&&void 0!==e[0]?e[0]:{};r.start(_objectSpread({enableRedraw:true,ignoreAnimation:true,ignoreMouse:true},t));yield r.ready();r.stop()}))()}
/**
   * Start rendering.
   * @param options - Render options.
   */start(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};var{documentElement:e,screen:r,options:i}=this;r.start(e,_objectSpread(_objectSpread({enableRedraw:true},i),t))}stop(){this.screen.stop()}
/**
   * Resize SVG to fit in given size.
   * @param width
   * @param height
   * @param preserveAspectRatio
   */resize(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:t;var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this.documentElement.resize(t,e,r)}}export{AElement,AnimateColorElement,AnimateElement,AnimateTransformElement,BoundingBox,CB1,CB2,CB3,CB4,Canvg,CircleElement,ClipPathElement,DefsElement,DescElement,Document,Element,EllipseElement,FeColorMatrixElement,FeCompositeElement,FeDropShadowElement,FeGaussianBlurElement,FeMorphologyElement,FilterElement,Font,FontElement,FontFaceElement,GElement,GlyphElement,GradientElement,ImageElement,LineElement,LinearGradientElement,MarkerElement,MaskElement,Matrix,MissingGlyphElement,Mouse,f as PSEUDO_ZERO,Parser,PathElement,PathParser,PatternElement,Point,PolygonElement,PolylineElement,Property,QB1,QB2,QB3,RadialGradientElement,RectElement,RenderedElement,Rotate,SVGElement,SVGFontLoader,Scale,Screen,Skew,SkewX,SkewY,StopElement,StyleElement,SymbolElement,TRefElement,TSpanElement,TextElement,TextPathElement,TitleElement,Transform,Translate,UnknownElement,UseElement,ViewPort,compressSpaces,Canvg as default,getSelectorSpecificity,normalizeAttributeName,normalizeColor,parseExternalUrl,n as presets,toNumbers,trimLeft,trimRight,vectorMagnitude,vectorsAngle,vectorsRatio};

